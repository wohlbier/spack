

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Packaging Guide &mdash; Spack 0.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Spack 0.8 documentation" href="index.html"/>
        <link rel="next" title="Mirrors" href="mirrors.html"/>
        <link rel="prev" title="Basic usage" href="basic_usage.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html">
        

        
          
          <img src="_static/spack-logo-white-text-48.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#simple-package-installation">Simple package installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#custom-versions-configurations">Custom versions &amp; configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#customize-dependencies">Customize dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#non-destructive-installs">Non-destructive installs</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#packages-can-peacefully-coexist">Packages can peacefully coexist</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#creating-packages-is-easy">Creating packages is easy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#download">Download</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#listing-available-packages">Listing available packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-list"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-info"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">info</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-versions"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">versions</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#installing-and-uninstalling">Installing and uninstalling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-install"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#building-a-specific-version">Building a specific version</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-uninstall"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">uninstall</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#seeing-installed-packages">Seeing installed packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-find"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">find</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#compiler-configuration">Compiler configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-compilers"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">compilers</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-compiler-add"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">add</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-compiler-find"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">find</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-compiler-info"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">compiler</span> <span class="pre">info</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#manual-compiler-configuration">Manual compiler configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#specs-dependencies">Specs &amp; dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#version-specifier">Version specifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#compiler-specifier">Compiler specifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#variants">Variants</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#architecture-specifier">Architecture specifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#virtual-dependencies">Virtual dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#constraining-virtual-packages">Constraining virtual packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-providers"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">providers</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#environment-modules">Environment modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#installing-environment-modules">Installing Environment Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-and-environment-modules">Spack and Environment Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#using-modules-dotkits">Using Modules &amp; Dotkits</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#ambiguous-module-names">Ambiguous module names</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#regenerating-module-files">Regenerating Module files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="basic_usage.html#spack-module-refresh"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">module</span> <span class="pre">refresh</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#extensions-python-support">Extensions &amp; Python support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-extensions"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">extensions</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#extensions-environment-modules">Extensions &amp; Environment Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#activating-extensions">Activating Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="basic_usage.html#spack-activate"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">activate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="basic_usage.html#spack-activate-f"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">activate</span> <span class="pre">-f</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="basic_usage.html#spack-deactivate"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">deactivate</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#getting-help">Getting Help</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#spack-help"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">help</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Packaging Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-editing-packages">Creating &amp; editing packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-create"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-edit"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-edit-f"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span> <span class="pre">-f</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#naming-directory-structure">Naming &amp; directory structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#var-spack-repos-builtin-packages"><code class="docutils literal"><span class="pre">var/spack/repos/builtin/packages</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-names">Package Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-class-names">Package class names</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-versions">Adding new versions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#version-urls">Version URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#skipping-the-expand-step">Skipping the expand step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checksums">Checksums</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spack-md5"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">md5</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#spack-checksum"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">checksum</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fetching-from-vcs-repositories">Fetching from VCS repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#repositories-and-versions">Repositories and versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#git">Git</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing">Installing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mercurial">Mercurial</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subversion">Subversion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#patches">Patches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#patch"><code class="docutils literal"><span class="pre">patch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#patch-functions"><code class="docutils literal"><span class="pre">patch()</span></code> functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handling-rpaths">Handling RPATHs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finding-new-versions">Finding new versions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-url"><code class="docutils literal"><span class="pre">list_url</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#list-depth"><code class="docutils literal"><span class="pre">list_depth</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parallel-builds">Parallel builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#depends-on"><code class="docutils literal"><span class="pre">depends_on()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependency-specs">Dependency specs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-dependent-environment"><code class="docutils literal"><span class="pre">setup_dependent_environment()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extensions">Extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#activation-deactivation">Activation &amp; deactivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activation-arguments">Activation arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-dependencies">Virtual dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#provides"><code class="docutils literal"><span class="pre">provides</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#versioned-interfaces">Versioned Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provides-when"><code class="docutils literal"><span class="pre">provides</span> <span class="pre">when</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#abstract-concrete-specs">Abstract &amp; concrete specs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#concretization">Concretization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-spec"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">spec</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#concretization-policies"><code class="docutils literal"><span class="pre">Concretization</span> <span class="pre">Policies</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implementing-the-install-method">Implementing the <code class="docutils literal"><span class="pre">install</span></code> method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-install-environment">The install environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-interceptors">Compiler interceptors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-flags">Compiler flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#message-parsing-interface-mpi">Message Parsing Interface (MPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#forking-install">Forking <code class="docutils literal"><span class="pre">install()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#failing-the-build">Failing the build</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">Prefix objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spec-objects">Spec objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-spec-constraints">Testing spec constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-dependencies">Accessing Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multimethods-and-when">Multimethods and <code class="docutils literal"><span class="pre">&#64;when</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#shell-command-functions">Shell command functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sanity-checking-an-intallation">Sanity checking an intallation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sanity-check-is-file-and-sanity-check-is-dir"><code class="docutils literal"><span class="pre">sanity_check_is_file</span></code> and <code class="docutils literal"><span class="pre">sanity_check_is_dir</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-manipulation-functions">File manipulation functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#filtering-functions">Filtering functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-functions">File functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-workflow-commands">Packaging workflow commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-fetch"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">fetch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-stage"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">stage</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-patch"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">patch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-restage"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">restage</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-clean"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">clean</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-purge"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">purge</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#keeping-the-stage-directory-on-success">Keeping the stage directory on success</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keeping-the-install-prefix-on-failure">Keeping the install prefix on failure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#graphing-dependencies">Graphing dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-graph"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">graph</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-shell-support">Interactive shell support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-cd"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-env"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">env</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#spack-location"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">location</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mirrors.html">Mirrors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#spack-mirror"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">mirror</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#spack-mirror-create"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">create</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="mirrors.html#custom-package-sets">Custom package sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="mirrors.html#mirror-files">Mirror files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#spack-mirror-add"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">add</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#spack-mirror-list"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#spack-mirror-remove"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">mirror</span> <span class="pre">remove</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="mirrors.html#mirror-precedence">Mirror precedence</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="site_configuration.html">Site configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="site_configuration.html#temporary-space">Temporary space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="site_configuration.html#external-packages">External Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="site_configuration.html#profiling">Profiling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="site_configuration.html#spack-p"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">-p</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#directory-structure">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#code-structure">Code Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#package-related-modules">Package-related modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#spec-related-modules">Spec-related modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#build-environment">Build environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#spack-subcommands">Spack Subcommands</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#unit-tests">Unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#other-modules">Other Modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#spec-objects">Spec objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#package-objects">Package objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#stage-objects">Stage objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#writing-commands">Writing commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#id3">Unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#unit-testing">Unit testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#developer-commands">Developer commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#spack-doc"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">doc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_guide.html#spack-test"><code class="docutils literal"><span class="pre">spack</span> <span class="pre">test</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_index.html">Command index</a></li>
<li class="toctree-l1"><a class="reference internal" href="package_list.html">Package List</a><ul>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#activeharmony">activeharmony</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#adept-utils">adept-utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#adol-c">adol-c</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#antlr">antlr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#apex">apex</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#apr">apr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#apr-util">apr-util</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#arpack">arpack</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#arpack-ng">arpack-ng</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#asciidoc">asciidoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#astyle">astyle</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#atk">atk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#atlas">atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#atop">atop</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#autoconf">autoconf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#automaded">automaded</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#automake">automake</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bash">bash</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bbcp">bbcp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bear">bear</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bib2xhtml">bib2xhtml</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#binutils">binutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bison">bison</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#blitz">blitz</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#boost">boost</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bowtie2">bowtie2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#boxlib">boxlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#bzip2">bzip2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cairo">cairo</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#caliper">caliper</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#callpath">callpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cblas">cblas</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cbtf">cbtf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cbtf-argonavis">cbtf-argonavis</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cbtf-krell">cbtf-krell</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cbtf-lanl">cbtf-lanl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cereal">cereal</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cfitsio">cfitsio</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cgal">cgal</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cgm">cgm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cityhash">cityhash</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cleverleaf">cleverleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cloog">cloog</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cmake">cmake</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cmocka">cmocka</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cnmem">cnmem</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#coreutils">coreutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cppcheck">cppcheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cram">cram</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cryptopp">cryptopp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cscope">cscope</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cube">cube</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#cuda">cuda</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#curl">curl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#czmq">czmq</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dakota">dakota</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#damselfly">damselfly</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dbus">dbus</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dealii">dealii</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dia">dia</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#docbook-xml">docbook-xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#doxygen">doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dri2proto">dri2proto</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dtcmp">dtcmp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#dyninst">dyninst</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#eigen">eigen</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#elfutils">elfutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#elk">elk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#elpa">elpa</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#emacs">emacs</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#environment-modules">environment-modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#espresso">espresso</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#exodusii">exodusii</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#expat">expat</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#extrae">extrae</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#exuberant-ctags">exuberant-ctags</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#fftw">fftw</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#fish">fish</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#flex">flex</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#fltk">fltk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#flux">flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#fontconfig">fontconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#freetype">freetype</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gasnet">gasnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gcc">gcc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gdal">gdal</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gdb">gdb</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gdk-pixbuf">gdk-pixbuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#geos">geos</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gettext">gettext</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gflags">gflags</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ghostscript">ghostscript</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#git">git</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gl2ps">gl2ps</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#glib">glib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#glm">glm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#global">global</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#glog">glog</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#glpk">glpk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gmp">gmp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gmsh">gmsh</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gnuplot">gnuplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gnutls">gnutls</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#googletest">googletest</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gperf">gperf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gperftools">gperftools</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#graphlib">graphlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#graphviz">graphviz</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gromacs">gromacs</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gsl">gsl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#gtkplus">gtkplus</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#harfbuzz">harfbuzz</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hdf">hdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hdf5">hdf5</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hoomd-blue">hoomd-blue</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hpx5">hpx5</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hwloc">hwloc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hydra">hydra</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#hypre">hypre</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#icu">icu</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#icu4c">icu4c</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#imagemagick">ImageMagick</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#intltool">intltool</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ior">ior</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ipopt">ipopt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#isl">isl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#jdk">jdk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#jemalloc">jemalloc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#jpeg">jpeg</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#judy">judy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#julia">julia</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#kealib">kealib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#kripke">kripke</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#launchmon">launchmon</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lcms">lcms</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#leveldb">leveldb</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libarchive">libarchive</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libcerf">libcerf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libcircle">libcircle</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libdrm">libdrm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libdwarf">libdwarf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libedit">libedit</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libelf">libelf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libevent">libevent</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libffi">libffi</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libgcrypt">libgcrypt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libgd">libgd</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libgpg-error">libgpg-error</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libjpeg-turbo">libjpeg-turbo</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libjson-c">libjson-c</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libmng">libmng</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libmonitor">libmonitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libnbc">libNBC</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libpciaccess">libpciaccess</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libpng">libpng</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libsigsegv">libsigsegv</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libsodium">libsodium</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libtermkey">libtermkey</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libtiff">libtiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libtool">libtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libunwind">libunwind</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libuuid">libuuid</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libuv">libuv</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libvterm">libvterm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libxc">libxc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libxcb">libxcb</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libxml2">libxml2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libxshmfence">libxshmfence</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#libxslt">libxslt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#llvm">llvm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#llvm-lld">llvm-lld</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lmdb">lmdb</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lmod">lmod</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lua">lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#luajit">LuaJIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lwgrp">lwgrp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#lwm2">lwm2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#m4">m4</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#matio">matio</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mbedtls">mbedtls</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#memaxes">memaxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mesa">mesa</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#metis">metis</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mfem">mfem</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mitos">Mitos</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpc">mpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpe2">mpe2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpfr">mpfr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpibash">mpibash</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpich">mpich</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mpileaks">mpileaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mrnet">mrnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#msgpack-c">msgpack-c</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mumps">mumps</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#munge">munge</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#muparser">muparser</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#muster">muster</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#mvapich2">mvapich2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#nasm">nasm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#nccmp">nccmp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ncdu">ncdu</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#nco">nco</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ncurses">ncurses</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ncview">ncview</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ndiff">ndiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netcdf">netcdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netcdf-cxx">netcdf-cxx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netcdf-cxx4">netcdf-cxx4</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netcdf-fortran">netcdf-fortran</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netgauge">netgauge</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netlib-lapack">netlib-lapack</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#netlib-scalapack">netlib-scalapack</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#nettle">nettle</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ninja">ninja</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#numdiff">numdiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#oce">oce</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#octave">octave</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ompss">ompss</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ompt-openmp">ompt-openmp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#opari2">opari2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#openblas">openblas</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#opencv">opencv</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#openjpeg">openjpeg</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#openmpi">openmpi</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#openspeedshop">openspeedshop</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#openssl">openssl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#osu-micro-benchmarks">osu-micro-benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#otf">otf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#otf2">otf2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#p4est">p4est</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pango">pango</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#papi">papi</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#paradiseo">paradiseo</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#parallel-netcdf">parallel-netcdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#paraver">paraver</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#paraview">paraview</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#parmetis">parmetis</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#parpack">parpack</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#patchelf">patchelf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pcre">pcre</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pcre2">pcre2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pdt">pdt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#petsc">petsc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pidx">pidx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pixman">pixman</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pkg-config">pkg-config</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#pmgr-collective">pmgr_collective</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#postgresql">postgresql</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ppl">ppl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#proj">proj</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#protobuf">protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-argcomplete">py-argcomplete</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-astropy">py-astropy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-basemap">py-basemap</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-biopython">py-biopython</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-blessings">py-blessings</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-bottleneck">py-bottleneck</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-cffi">py-cffi</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-coverage">py-coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-csvkit">py-csvkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-cython">py-cython</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-dask">py-dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-dateutil">py-dateutil</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-dbf">py-dbf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-decorator">py-decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-epydoc">py-epydoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-funcsigs">py-funcsigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-genders">py-genders</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-gnuplot">py-gnuplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-h5py">py-h5py</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-ipython">py-ipython</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-jdcal">py-jdcal</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-lockfile">py-lockfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mako">py-mako</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-matplotlib">py-matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mock">py-mock</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mpi4py">py-mpi4py</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mpmath">py-mpmath</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mx">py-mx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-mysqldb1">py-mysqldb1</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-netcdf">py-netcdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-networkx">py-networkx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-nose">py-nose</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-numexpr">py-numexpr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-numpy">py-numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-openpyxl">py-openpyxl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pandas">py-pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pbr">py-pbr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-periodictable">py-periodictable</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pexpect">py-pexpect</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-phonopy">py-phonopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pil">py-pil</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pillow">py-pillow</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pmw">py-pmw</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pychecker">py-pychecker</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pycparser">py-pycparser</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pyelftools">py-pyelftools</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pygments">py-pygments</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pylint">py-pylint</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pypar">py-pypar</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pyparsing">py-pyparsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pyqt">py-pyqt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pyside">py-pyside</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pytables">py-pytables</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-python-daemon">py-python-daemon</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pytz">py-pytz</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-pyyaml">py-pyyaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-rpy2">py-rpy2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-scientificpython">py-scientificpython</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-scikit-image">py-scikit-image</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-scikit-learn">py-scikit-learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-scipy">py-scipy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-setuptools">py-setuptools</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-shiboken">py-shiboken</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-sip">py-sip</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-six">py-six</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-sphinx">py-sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-sqlalchemy">py-SQLAlchemy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-sympy">py-sympy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-tappy">py-tappy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-tuiview">py-tuiview</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-twisted">py-twisted</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-urwid">py-urwid</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-virtualenv">py-virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-wheel">py-wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-xlrd">py-xlrd</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#py-yapf">py-yapf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#python">python</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#qhull">qhull</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#qrupdate">qrupdate</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#qt">qt</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#qthreads">qthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#r">R</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#r-abind">r-abind</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#r-biocgenerics">r-BiocGenerics</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#r-filehash">r-filehash</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#r-magic">r-magic</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#raja">raja</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ravel">ravel</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#readline">readline</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#rose">rose</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#rsync">rsync</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#ruby">ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#samrai">SAMRAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#samtools">samtools</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#scalasca">scalasca</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#scons">scons</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#scorep">scorep</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#scotch">scotch</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#scr">scr</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#serf">serf</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#silo">silo</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#slepc">slepc</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#snappy">snappy</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#sparsehash">sparsehash</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#spindle">spindle</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#spot">spot</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#sqlite">sqlite</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#stat">stat</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#subversion">subversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#suite-sparse">suite-sparse</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#sundials">sundials</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#superlu-dist">superlu-dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#swig">swig</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#szip">szip</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tar">tar</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#task">task</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#taskd">taskd</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tau">tau</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tbb">tbb</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tcl">tcl</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tetgen">tetgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#texinfo">texinfo</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#the-silver-searcher">the_silver_searcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#thrift">thrift</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tk">tk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tmux">tmux</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#tmuxinator">tmuxinator</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#triangle">triangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#trilinos">trilinos</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#turbomole">turbomole</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#udunits2">udunits2</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#uncrustify">uncrustify</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#unibilium">unibilium</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#util-linux">util-linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#valgrind">valgrind</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#vim">vim</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#visit">visit</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#vtk">vtk</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#wget">wget</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#wx">wx</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#wxpropgrid">wxpropgrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#xcb-proto">xcb-proto</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#xerces-c">xerces-c</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#xz">xz</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#yasm">yasm</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#zeromq">zeromq</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#zfp">zfp</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#zlib">zlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#zoltan">zoltan</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_list.html#zsh">zsh</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spack.html">API Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spack.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spack.cmd.html">spack.cmd package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.activate">spack.cmd.activate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.arch">spack.cmd.arch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.bootstrap">spack.cmd.bootstrap module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.cd">spack.cmd.cd module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.checksum">spack.cmd.checksum module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.clean">spack.cmd.clean module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.compiler">spack.cmd.compiler module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.compilers">spack.cmd.compilers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.config">spack.cmd.config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.create">spack.cmd.create module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.deactivate">spack.cmd.deactivate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.dependents">spack.cmd.dependents module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.diy">spack.cmd.diy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.doc">spack.cmd.doc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.edit">spack.cmd.edit module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.env">spack.cmd.env module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.extensions">spack.cmd.extensions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.fetch">spack.cmd.fetch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.find">spack.cmd.find module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.graph">spack.cmd.graph module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.help">spack.cmd.help module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.info">spack.cmd.info module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.install">spack.cmd.install module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.list">spack.cmd.list module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.load">spack.cmd.load module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.location">spack.cmd.location module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.md5">spack.cmd.md5 module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.mirror">spack.cmd.mirror module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.module">spack.cmd.module module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#spack-cmd-package-list-module">spack.cmd.package-list module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.patch">spack.cmd.patch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.pkg">spack.cmd.pkg module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.providers">spack.cmd.providers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.purge">spack.cmd.purge module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.python">spack.cmd.python module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.reindex">spack.cmd.reindex module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.repo">spack.cmd.repo module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.restage">spack.cmd.restage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.spec">spack.cmd.spec module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.stage">spack.cmd.stage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#spack-cmd-test-install-module">spack.cmd.test-install module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.test">spack.cmd.test module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.uninstall">spack.cmd.uninstall module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.unload">spack.cmd.unload module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.unuse">spack.cmd.unuse module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#spack-cmd-url-parse-module">spack.cmd.url-parse module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.urls">spack.cmd.urls module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.use">spack.cmd.use module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd.versions">spack.cmd.versions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.cmd.html#module-spack.cmd">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spack.compilers.html">spack.compilers package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.clang">spack.compilers.clang module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.gcc">spack.compilers.gcc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.intel">spack.compilers.intel module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.nag">spack.compilers.nag module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.pgi">spack.compilers.pgi module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers.xl">spack.compilers.xl module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.compilers.html#module-spack.compilers">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spack.hooks.html">spack.hooks package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#module-spack.hooks.dotkit">spack.hooks.dotkit module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#module-spack.hooks.extensions">spack.hooks.extensions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#module-spack.hooks.sbang">spack.hooks.sbang module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#module-spack.hooks.tclmodule">spack.hooks.tclmodule module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.hooks.html#module-spack.hooks">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spack.test.html">spack.test package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.cc">spack.test.cc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.concretize">spack.test.concretize module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.config">spack.test.config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.configure_guess">spack.test.configure_guess module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.database">spack.test.database module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.directory_layout">spack.test.directory_layout module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.environment">spack.test.environment module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.git_fetch">spack.test.git_fetch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.hg_fetch">spack.test.hg_fetch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.install">spack.test.install module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.link_tree">spack.test.link_tree module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.lock">spack.test.lock module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.make_executable">spack.test.make_executable module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.mirror">spack.test.mirror module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.mock_database">spack.test.mock_database module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.mock_packages_test">spack.test.mock_packages_test module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.mock_repo">spack.test.mock_repo module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.multimethod">spack.test.multimethod module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.namespace_trie">spack.test.namespace_trie module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.optional_deps">spack.test.optional_deps module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.package_sanity">spack.test.package_sanity module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.packages">spack.test.packages module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.pattern">spack.test.pattern module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.python_version">spack.test.python_version module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.sbang">spack.test.sbang module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.spec_dag">spack.test.spec_dag module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.spec_semantics">spack.test.spec_semantics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.spec_syntax">spack.test.spec_syntax module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.spec_yaml">spack.test.spec_yaml module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.stage">spack.test.stage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.svn_fetch">spack.test.svn_fetch module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.tally_plugin">spack.test.tally_plugin module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.url_extrapolate">spack.test.url_extrapolate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.url_parse">spack.test.url_parse module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.url_substitution">spack.test.url_substitution module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.versions">spack.test.versions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test.yaml">spack.test.yaml module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.test.html#module-spack.test">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spack.util.html">spack.util package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.compression">spack.util.compression module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.crypto">spack.util.crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.debug">spack.util.debug module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.environment">spack.util.environment module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.executable">spack.util.executable module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.multiproc">spack.util.multiproc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.naming">spack.util.naming module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.pattern">spack.util.pattern module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.prefix">spack.util.prefix module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.spack_yaml">spack.util.spack_yaml module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.string">spack.util.string module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util.web">spack.util.web module</a></li>
<li class="toctree-l4"><a class="reference internal" href="spack.util.html#module-spack.util">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.abi">spack.abi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.architecture">spack.architecture module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.build_environment">spack.build_environment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.compiler">spack.compiler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.concretize">spack.concretize module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.config">spack.config module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spack.html#configuration-file-scopes">Configuration file scopes</a></li>
<li class="toctree-l3"><a class="reference internal" href="spack.html#configuration-file-format">Configuration file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="spack.html#precedence">Precedence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.database">spack.database module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.directives">spack.directives module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.directory_layout">spack.directory_layout module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.environment">spack.environment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.error">spack.error module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.fetch_strategy">spack.fetch_strategy module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.graph">spack.graph module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.mirror">spack.mirror module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.modules">spack.modules module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.multimethod">spack.multimethod module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.package">spack.package module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.parse">spack.parse module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.patch">spack.patch module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.preferred_packages">spack.preferred_packages module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.repository">spack.repository module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.resource">spack.resource module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.spec">spack.spec module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.stage">spack.stage module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.url">spack.url module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.variant">spack.variant module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.version">spack.version module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack.virtual">spack.virtual module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spack.html#module-spack">Module contents</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Spack</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Packaging Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/packaging_guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="packaging-guide">
<span id="id1"></span><h1>Packaging Guide<a class="headerlink" href="#packaging-guide" title="Permalink to this headline"></a></h1>
<p>This guide is intended for developers or administrators who want to
package software so that Spack can install it.  It assumes that you
have at least some familiarity with Python, and that you&#8217;ve read the
<a class="reference internal" href="basic_usage.html#basic-usage"><span>basic usage guide</span></a>, especially the part about
<a class="reference internal" href="basic_usage.html#sec-specs"><span>specs</span></a>.</p>
<p>There are two key parts of Spack:</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>Specs</strong>: expressions for describing builds of software, and</li>
<li><strong>Packages</strong>: Python modules that describe how to build
software according to a spec.</li>
</ol>
</div></blockquote>
<p>Specs allow a user to describe a <em>particular</em> build in a way that a
package author can understand.  Packages allow a the packager to
encapsulate the build logic for different versions, compilers,
options, platforms, and dependency combinations in one place.
Essentially, a package translates a spec into build logic.</p>
<p>Packages in Spack are written in pure Python, so you can do anything
in Spack that you can do in Python.  Python was chosen as the
implementation language for two reasons.  First, Python is becoming
ubiquitous in the scientific software community. Second, it&#8217;s a modern
language and has many powerful features to help make package writing
easy.</p>
<div class="section" id="creating-editing-packages">
<h2>Creating &amp; editing packages<a class="headerlink" href="#creating-editing-packages" title="Permalink to this headline"></a></h2>
<div class="section" id="spack-create">
<span id="id2"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code><a class="headerlink" href="#spack-create" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> command generates a boilerplate package template
from a URL.  The URL should point to a tarball or other software
archive.  In most cases, <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> plus a few modifications is
all you need to get a package working.</p>
<p>Here&#8217;s an example:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack create http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz
</pre></div>
</div>
<p>Spack examines the tarball URL and tries to figure out the name of the
package to be created. It also tries to determine what version strings
look like for this package. Using this information, it will try to
find <em>additional</em> versions by spidering the package&#8217;s webpage.  If it
finds multiple versions, Spack prompts you to tell it how many
versions you want to download and checksum:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack create http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz
<span class="o">==</span>&gt; This looks like a URL <span class="k">for</span> cmake version 2.8.12.1.
<span class="o">==</span>&gt; Creating template <span class="k">for</span> package <span class="nv">cmake</span>
<span class="o">==</span>&gt; Found <span class="m">18</span> versions of cmake.
  2.8.12.1  http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz
  2.8.12    http://www.cmake.org/files/v2.8/cmake-2.8.12.tar.gz
  2.8.11.2  http://www.cmake.org/files/v2.8/cmake-2.8.11.2.tar.gz
  ...
  2.8.0     http://www.cmake.org/files/v2.8/cmake-2.8.0.tar.gz

Include how many checksums in the package file? <span class="o">(</span>default is 5, q to abort<span class="o">)</span>
</pre></div>
</div>
<p>Spack will automatically download the number of tarballs you specify
(starting with the most recent) and checksum each of them.</p>
<p>You do not <em>have</em> to download all of the versions up front. You can
always choose to download just one tarball initially, and run
<a class="reference internal" href="#spack-checksum"><span>spack checksum</span></a> later if you need more.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> fails to detect the package name correctly,
you can try supplying it yourself, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ spack create --name cmake  http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz
</pre></div>
</div>
<p class="last">If it fails entirely, you can get minimal boilerplate by using
<a class="reference internal" href="#spack-edit-f"><span>spack edit -f</span></a>, or you can manually create a directory and
<code class="docutils literal"><span class="pre">package.py</span></code> file for the package in <code class="docutils literal"><span class="pre">var/spack/repos/builtin/packages</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Spack can fetch packages from source code repositories, but,
<code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> will <em>not</em> currently create a boilerplate package
from a repository URL.  You will need to use <a class="reference internal" href="#spack-edit-f"><span>spack edit -f</span></a>
and manually edit the <code class="docutils literal"><span class="pre">version()</span></code> directives to fetch from a
repo.  See <a class="reference internal" href="#vcs-fetch"><span>Fetching from VCS repositories</span></a> for details.</p>
</div>
<p>Let&#8217;s say you download 3 tarballs:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>Include how many checksums in the package file? <span class="o">(</span>default is 5, q to abort<span class="o">)</span> <span class="nv">3</span>
<span class="o">==</span>&gt; Downloading...
<span class="o">==</span>&gt; Fetching http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz
<span class="c1">######################################################################    98.6%</span>
<span class="o">==</span>&gt; Fetching http://www.cmake.org/files/v2.8/cmake-2.8.12.tar.gz
<span class="c1">#####################################################################     96.7%</span>
<span class="o">==</span>&gt; Fetching http://www.cmake.org/files/v2.8/cmake-2.8.11.2.tar.gz
<span class="c1">####################################################################      95.2%</span>
</pre></div>
</div>
<p>Now Spack generates boilerplate code and opens a new <code class="docutils literal"><span class="pre">package.py</span></code>
file in your favorite <code class="docutils literal"><span class="pre">$EDITOR</span></code>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># FIXME:</span>
<span class="c1"># This is a template package file for Spack.  We&#39;ve conveniently</span>
<span class="c1"># put &quot;FIXME&quot; labels next to all the things you&#39;ll want to change.</span>
<span class="c1">#</span>
<span class="c1"># Once you&#39;ve edited all the FIXME&#39;s, delete this whole message,</span>
<span class="c1"># save this file, and test out your package like this:</span>
<span class="c1">#</span>
<span class="c1">#     spack install cmake</span>
<span class="c1">#</span>
<span class="c1"># You can always get back here to change things with:</span>
<span class="c1">#</span>
<span class="c1">#     spack edit cmake</span>
<span class="c1">#</span>
<span class="c1"># See the spack documentation for more information on building</span>
<span class="c1"># packages.</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">spack</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Cmake</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FIXME: put a proper description of your package here.&quot;&quot;&quot;</span>
    <span class="c1"># FIXME: add a proper url for your package&#39;s homepage here.</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.example.com&quot;</span>
    <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz&quot;</span>

    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;2.8.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;9d38cd4e2c94c3cea97d0e2924814acc&#39;</span><span class="p">)</span>
    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;2.8.12&#39;</span><span class="p">,</span>   <span class="s1">&#39;105bc6d21cc2e9b6aff901e43c53afea&#39;</span><span class="p">)</span>
    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;2.8.11.2&#39;</span><span class="p">,</span> <span class="s1">&#39;6f5d7b8e7534a5d9e1a7664ba63cf882&#39;</span><span class="p">)</span>

    <span class="c1"># FIXME: Add dependencies if this package requires them.</span>
    <span class="c1"># depends_on(&quot;foo&quot;)</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># FIXME: Modify the configure line to suit your build system here.</span>
        <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>

        <span class="c1"># FIXME: Add logic to build and install here</span>
        <span class="n">make</span><span class="p">()</span>
        <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The tedious stuff (creating the class, checksumming archives) has been
done for you.</p>
<p>In the generated package, the download <code class="docutils literal"><span class="pre">url</span></code> attribute is already
set.  All the things you still need to change are marked with
<code class="docutils literal"><span class="pre">FIXME</span></code> labels.  The first <code class="docutils literal"><span class="pre">FIXME</span></code> refers to the commented
instructions at the top of the file.  You can delete these
instructions after reading them.  The rest of them are as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Add a description.</p>
<p>Immediately inside the package class is a <em>docstring</em> in
triple-quotes (<code class="docutils literal"><span class="pre">&quot;&quot;&quot;</span></code>).  It&#8217;s used to generate the description
shown when users run <code class="docutils literal"><span class="pre">spack</span> <span class="pre">info</span></code>.</p>
</li>
<li><p class="first">Change the <code class="docutils literal"><span class="pre">homepage</span></code> to a useful URL.</p>
<p>The <code class="docutils literal"><span class="pre">homepage</span></code> is displayed when users run <code class="docutils literal"><span class="pre">spack</span> <span class="pre">info</span></code> so
that they can learn about packages.</p>
</li>
<li><p class="first">Add <code class="docutils literal"><span class="pre">depends_on()</span></code> calls for the package&#8217;s dependencies.</p>
<p><code class="docutils literal"><span class="pre">depends_on</span></code> tells Spack that other packages need to be built
and installed before this one.  See <cite>dependencies_</cite>.</p>
</li>
<li><p class="first">Get the <code class="docutils literal"><span class="pre">install()</span></code> method working.</p>
<p>The <code class="docutils literal"><span class="pre">install()</span></code> method implements the logic to build a
package.  The code should look familiar; it is designed to look
like a shell script. Specifics will differ depending on the package,
and <a class="reference internal" href="#install-method"><span>implementing the install method</span></a> is
covered in detail later.</p>
</li>
</ol>
</div></blockquote>
<p>Before going into details, we&#8217;ll cover a few more basics.</p>
</div>
<div class="section" id="spack-edit">
<span id="id3"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span></code><a class="headerlink" href="#spack-edit" title="Permalink to this headline"></a></h3>
<p>One of the easiest ways to learn to write packages is to look at
existing ones.  You can edit a package file by name with the <code class="docutils literal"><span class="pre">spack</span>
<span class="pre">edit</span></code> command:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack edit cmake
</pre></div>
</div>
<p>So, if you used <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> to create a package, then saved and
closed the resulting file, you can get back to it with <code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span></code>.
The <code class="docutils literal"><span class="pre">cmake</span></code> package actually lives in
<code class="docutils literal"><span class="pre">$SPACK_ROOT/var/spack/repos/builtin/packages/cmake/package.py</span></code>, but this provides
a much simpler shortcut and saves you the trouble of typing the full
path.</p>
<p>If you try to edit a package that doesn&#8217;t exist, Spack will recommend
using <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> or <code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span> <span class="pre">-f</span></code>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack edit <span class="nv">foo</span>
<span class="o">==</span>&gt; Error: No package <span class="s1">&#39;foo&#39;</span>.  Use spack create, or supply -f/--force to edit a new file.
</pre></div>
</div>
</div>
<div class="section" id="spack-edit-f">
<span id="id4"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span> <span class="pre">-f</span></code><a class="headerlink" href="#spack-edit-f" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span> <span class="pre">-f</span></code> can be used to create a new, minimal boilerplate
package:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack edit -f foo
</pre></div>
</div>
<p>Unlike <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code>, which infers names and versions, and which
actually downloads the tarball and checksums it for you, <code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span>
<span class="pre">-f</span></code> has no such fanciness.  It will substitute dummy values for you
to fill in yourself:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spack</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Description&quot;&quot;&quot;</span>

    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.example.com&quot;</span>
    <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.example.com/foo-1.0.tar.gz&quot;</span>

    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="s1">&#39;0123456789abcdef0123456789abcdef&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="n">make</span><span class="p">()</span>
        <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This is useful when <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> cannot figure out the name and
version of your package from the archive URL.</p>
</div>
</div>
<div class="section" id="naming-directory-structure">
<h2>Naming &amp; directory structure<a class="headerlink" href="#naming-directory-structure" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Spack&#8217;s default naming and directory structure will change in
version 0.9.  Specifically, 0.9 will stop using directory names
with special characters like <code class="docutils literal"><span class="pre">&#64;</span></code>, to avoid interfering with
certain packages that do not handle this well.</p>
</div>
<p>This section describes how packages need to be named, and where they
live in Spack&#8217;s directory structure.  In general, <a class="reference internal" href="#spack-create">spack-create</a> and
<a class="reference internal" href="#spack-edit">spack-edit</a> handle creating package files for you, so you can skip
most of the details here.</p>
<div class="section" id="var-spack-repos-builtin-packages">
<h3><code class="docutils literal"><span class="pre">var/spack/repos/builtin/packages</span></code><a class="headerlink" href="#var-spack-repos-builtin-packages" title="Permalink to this headline"></a></h3>
<p>A Spack installation directory is structured like a standard UNIX
install prefix (<code class="docutils literal"><span class="pre">bin</span></code>, <code class="docutils literal"><span class="pre">lib</span></code>, <code class="docutils literal"><span class="pre">include</span></code>, <code class="docutils literal"><span class="pre">var</span></code>, <code class="docutils literal"><span class="pre">opt</span></code>,
etc.).  Most of the code for Spack lives in <code class="docutils literal"><span class="pre">$SPACK_ROOT/lib/spack</span></code>.
Packages themselves live in <code class="docutils literal"><span class="pre">$SPACK_ROOT/var/spack/repos/builtin/packages</span></code>.</p>
<p>If you <code class="docutils literal"><span class="pre">cd</span></code> to that directory, you will see directories for each
package:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ cd $SPACK_ROOT/var/spack/repos/builtin/packages;  ls -CF
ImageMagick/	      julia/		     py-epydoc/
LuaJIT/		      kealib/		     py-funcsigs/
Mitos/		      kripke/		     py-genders/
QScintilla-gpl/       launchmon/	     py-gnuplot/
R/		      lcms/		     py-h5py/
SAMRAI/		      leveldb/		     py-ipython/
SuiteSparse/	      libNBC/		     py-jdcal/
activeharmony/	      libarchive/	     py-libxml2/
adept-utils/	      libcerf/		     py-lockfile/
adol-c/		      libcircle/	     py-mako/
...
</pre></div>
</div>
<p>Each directory contains a file called <code class="docutils literal"><span class="pre">package.py</span></code>, which is where
all the python code for the package goes.  For example, the <code class="docutils literal"><span class="pre">libelf</span></code>
package lives in:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$SPACK_ROOT/var/spack/repos/builtin/packages/libelf/package.py
</pre></div>
</div>
<p>Alongside the <code class="docutils literal"><span class="pre">package.py</span></code> file, a package may contain extra
directories or files (like patches) that it needs to build.</p>
</div>
<div class="section" id="package-names">
<h3>Package Names<a class="headerlink" href="#package-names" title="Permalink to this headline"></a></h3>
<p>Packages are named after the directory containing <code class="docutils literal"><span class="pre">package.py</span></code>.  So,
<code class="docutils literal"><span class="pre">libelf</span></code>&#8216;s <code class="docutils literal"><span class="pre">package.py</span></code> lives in a directory called <code class="docutils literal"><span class="pre">libelf</span></code>.
The <code class="docutils literal"><span class="pre">package.py</span></code> file defines a class called <code class="docutils literal"><span class="pre">Libelf</span></code>, which
extends Spack&#8217;s <code class="docutils literal"><span class="pre">Package</span></code> class.  for example, here is
<code class="docutils literal"><span class="pre">$SPACK_ROOT/var/spack/repos/builtin/packages/libelf/package.py</span></code>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spack</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Libelf</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ... description ... &quot;&quot;&quot;</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">url</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">version</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">():</span>
        <span class="o">...</span>
</pre></div>
</td></tr></table></div>
<p>The <strong>directory name</strong> (<code class="docutils literal"><span class="pre">libelf</span></code>) determines the package name that
users should provide on the command line. e.g., if you type any of
these:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack install libelf
$ spack install libelf@0.8.13
</pre></div>
</div>
<p>Spack sees the package name in the spec and looks for
<code class="docutils literal"><span class="pre">libelf/package.py</span></code> in <code class="docutils literal"><span class="pre">var/spack/repos/builtin/packages</span></code>.  Likewise, if you say
<code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">py-numpy</span></code>, then Spack looks for
<code class="docutils literal"><span class="pre">py-numpy/package.py</span></code>.</p>
<p>Spack uses the directory name as the package name in order to give
packagers more freedom in naming their packages.  Package names can
contain letters, numbers, dashes, and underscores.  Using a Python
identifier (e.g., a class name or a module name) would make it
difficult to support these options.  So, you can name a package
<code class="docutils literal"><span class="pre">3proxy</span></code> or <code class="docutils literal"><span class="pre">_foo</span></code> and Spack won&#8217;t care.  It just needs to see
that name in the package spec.</p>
</div>
<div class="section" id="package-class-names">
<h3>Package class names<a class="headerlink" href="#package-class-names" title="Permalink to this headline"></a></h3>
<p>Spack loads <code class="docutils literal"><span class="pre">package.py</span></code> files dynamically, and it needs to find a
special class name in the file for the load to succeed.  The <strong>class
name</strong> (<code class="docutils literal"><span class="pre">Libelf</span></code> in our example) is formed by converting words
separated by <cite>-</cite> or <code class="docutils literal"><span class="pre">_</span></code> in the file name to camel case.  If the name
starts with a number, we prefix the class name with <code class="docutils literal"><span class="pre">_</span></code>. Here are
some examples:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Class Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">foo_bar</span></code></td>
<td><code class="docutils literal"><span class="pre">FooBar</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">docbook-xml</span></code></td>
<td><code class="docutils literal"><span class="pre">DocbookXml</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">FooBar</span></code></td>
<td><code class="docutils literal"><span class="pre">Foobar</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">3proxy</span></code></td>
<td><code class="docutils literal"><span class="pre">_3proxy</span></code></td>
</tr>
</tbody>
</table>
<p>In general, you won&#8217;t have to remember this naming convention because
<a class="reference internal" href="#spack-create">spack-create</a> and <a class="reference internal" href="#spack-edit">spack-edit</a> handle the details for you.</p>
</div>
</div>
<div class="section" id="adding-new-versions">
<h2>Adding new versions<a class="headerlink" href="#adding-new-versions" title="Permalink to this headline"></a></h2>
<p>The most straightforward way to add new versions to your package is to
add a line like this in the package class:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://example.com/foo-1.0.tar.gz&#39;</span>
    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;8.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;4136d7b4c04df68b686570afa26988ac&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="version-urls">
<h3>Version URLs<a class="headerlink" href="#version-urls" title="Permalink to this headline"></a></h3>
<p>By default, each version&#8217;s URL is extrapolated from the <code class="docutils literal"><span class="pre">url</span></code> field
in the package.  For example, Spack is smart enough to download
version <code class="docutils literal"><span class="pre">8.2.1.</span></code> of the <code class="docutils literal"><span class="pre">Foo</span></code> package above from
<code class="docutils literal"><span class="pre">http://example.com/foo-8.2.1.tar.gz</span></code>.</p>
<p>If spack <em>cannot</em> extrapolate the URL from the <code class="docutils literal"><span class="pre">url</span></code> field, or if
the package doesn&#8217;t have a <code class="docutils literal"><span class="pre">url</span></code> field, you can add a URL explicitly
for a particular version:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;8.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;4136d7b4c04df68b686570afa26988ac&#39;</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com/foo-8.2.1-special-version.tar.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the URL above, you might have to add an explicit URL because the
version can&#8217;t simply be substituted in the original <code class="docutils literal"><span class="pre">url</span></code> to
construct the new one for <code class="docutils literal"><span class="pre">8.2.1</span></code>.</p>
<p>When you supply a custom URL for a version, Spack uses that URL
<em>verbatim</em> and does not perform extrapolation.</p>
</div>
<div class="section" id="skipping-the-expand-step">
<h3>Skipping the expand step<a class="headerlink" href="#skipping-the-expand-step" title="Permalink to this headline"></a></h3>
<p>Spack normally expands archives automatically after downloading
them. If you want to skip this step (e.g., for self-extracting
executables and other custom archive types), you can add
<code class="docutils literal"><span class="pre">expand=False</span></code> to a <code class="docutils literal"><span class="pre">version</span></code> directive.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;8.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;4136d7b4c04df68b686570afa26988ac&#39;</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com/foo-8.2.1-special-version.tar.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;expand=False&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal"><span class="pre">expand</span></code> is set to <code class="docutils literal"><span class="pre">False</span></code>, Spack sets the current working
directory to the directory containing the downloaded archive before it
calls your <code class="docutils literal"><span class="pre">install</span></code> method.  Within <code class="docutils literal"><span class="pre">install</span></code>, the path to the
downloaded archive is available as <code class="docutils literal"><span class="pre">self.stage.archive_file</span></code>.</p>
<p>Here is an example snippet for packages distributed as self-extracting
archives.  The example sets permissions on the downloaded file to make
it executable, then runs it with some arguments.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">set_executable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">archive_file</span><span class="p">)</span>
    <span class="n">installer</span> <span class="o">=</span> <span class="n">Executable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">archive_file</span><span class="p">)</span>
    <span class="n">installer</span><span class="p">(</span><span class="s1">&#39;--prefix=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;arg1&#39;</span><span class="p">,</span> <span class="s1">&#39;arg2&#39;</span><span class="p">,</span> <span class="s1">&#39;etc.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="checksums">
<h3>Checksums<a class="headerlink" href="#checksums" title="Permalink to this headline"></a></h3>
<p>Spack uses a checksum to ensure that the downloaded package version is
not corrupted or compromised.  This is especially important when
fetching from insecure sources, like unencrypted http.  By default, a
package will <em>not</em> be installed if it doesn&#8217;t pass a checksum test
(though you can override this with <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">--no-checksum</span></code>).</p>
<p>Spack can currently support checksums using the MD5, SHA-1, SHA-224,
SHA-256, SHA-384, and SHA-512 algorithms.  It determines the algorithm
to use based on the hash length.</p>
<div class="section" id="spack-md5">
<h4><code class="docutils literal"><span class="pre">spack</span> <span class="pre">md5</span></code><a class="headerlink" href="#spack-md5" title="Permalink to this headline"></a></h4>
<p>If you have a single file to checksum, you can use the <code class="docutils literal"><span class="pre">spack</span> <span class="pre">md5</span></code>
command to do it.  Here&#8217;s how you might download an archive and get a
checksum for it:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ curl -O http://exmaple.com/foo-8.2.1.tar.gz&#39;
$ spack md5 foo-8.2.1.tar.gz
4136d7b4c04df68b686570afa26988ac  foo-8.2.1.tar.gz
</pre></div>
</div>
<p>Doing this for lots of files, or whenever a new package version is
released, is tedious.  See <code class="docutils literal"><span class="pre">spack</span> <span class="pre">checksum</span></code> below for an automated
version of this process.</p>
</div>
<div class="section" id="spack-checksum">
<span id="id5"></span><h4><code class="docutils literal"><span class="pre">spack</span> <span class="pre">checksum</span></code><a class="headerlink" href="#spack-checksum" title="Permalink to this headline"></a></h4>
<p>If you want to add new versions to a package you&#8217;ve already created,
this is automated with the <code class="docutils literal"><span class="pre">spack</span> <span class="pre">checksum</span></code> command.  Here&#8217;s an
example for <code class="docutils literal"><span class="pre">libelf</span></code>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack checksum <span class="nv">libelf</span>
<span class="o">==</span>&gt; Found <span class="m">16</span> versions of libelf.
  0.8.13    http://www.mr511.de/software/libelf-0.8.13.tar.gz
  0.8.12    http://www.mr511.de/software/libelf-0.8.12.tar.gz
  0.8.11    http://www.mr511.de/software/libelf-0.8.11.tar.gz
  0.8.10    http://www.mr511.de/software/libelf-0.8.10.tar.gz
  0.8.9     http://www.mr511.de/software/libelf-0.8.9.tar.gz
  0.8.8     http://www.mr511.de/software/libelf-0.8.8.tar.gz
  0.8.7     http://www.mr511.de/software/libelf-0.8.7.tar.gz
  0.8.6     http://www.mr511.de/software/libelf-0.8.6.tar.gz
  0.8.5     http://www.mr511.de/software/libelf-0.8.5.tar.gz
  ...
  0.5.2     http://www.mr511.de/software/libelf-0.5.2.tar.gz

How many would you like to checksum? <span class="o">(</span>default is 5, q to abort<span class="o">)</span>
</pre></div>
</div>
<p>This does the same thing that <code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> does, but it allows you
to go back and add new versions easily as you need them (e.g., as
they&#8217;re released).  It fetches the tarballs you ask for and prints out
a list of <code class="docutils literal"><span class="pre">version</span></code> commands ready to copy/paste into your package
file:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">==</span>&gt; Checksummed new versions of libelf:
    version<span class="o">(</span><span class="s1">&#39;0.8.13&#39;</span>, <span class="s1">&#39;4136d7b4c04df68b686570afa26988ac&#39;</span><span class="o">)</span>
    version<span class="o">(</span><span class="s1">&#39;0.8.12&#39;</span>, <span class="s1">&#39;e21f8273d9f5f6d43a59878dc274fec7&#39;</span><span class="o">)</span>
    version<span class="o">(</span><span class="s1">&#39;0.8.11&#39;</span>, <span class="s1">&#39;e931910b6d100f6caa32239849947fbf&#39;</span><span class="o">)</span>
    version<span class="o">(</span><span class="s1">&#39;0.8.10&#39;</span>, <span class="s1">&#39;9db4d36c283d9790d8fa7df1f4d7b4d9&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>By default, Spack will search for new tarball downloads by scraping
the parent directory of the tarball you gave it.  So, if your tarball
is at <code class="docutils literal"><span class="pre">http://example.com/downloads/foo-1.0.tar.gz</span></code>, Spack will look
in <code class="docutils literal"><span class="pre">http://example.com/downloads/</span></code> for links to additional versions.
If you need to search another path for download links, you can supply
some extra attributes that control how your package finds new
versions. See the documentation on <a class="reference internal" href="#attribute-list-url">attribute_list_url</a> and
<a class="reference internal" href="#attribute-list-depth">attribute_list_depth</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>This command assumes that Spack can extrapolate new URLs from an
existing URL in the package, and that Spack can find similar URLs
on a webpage.  If that&#8217;s not possible, e.g. if the package&#8217;s
developers don&#8217;t name their tarballs consistently, you&#8217;ll need to
manually add <code class="docutils literal"><span class="pre">version</span></code> calls yourself.</li>
<li>For <code class="docutils literal"><span class="pre">spack</span> <span class="pre">checksum</span></code> to work, Spack needs to be able to
<code class="docutils literal"><span class="pre">import</span></code> your package in Python.  That means it can&#8217;t have any
syntax errors, or the <code class="docutils literal"><span class="pre">import</span></code> will fail.  Use this once you&#8217;ve
got your package in working order.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="fetching-from-vcs-repositories">
<span id="vcs-fetch"></span><h2>Fetching from VCS repositories<a class="headerlink" href="#fetching-from-vcs-repositories" title="Permalink to this headline"></a></h2>
<p>For some packages, source code is provided in a Version Control System
(VCS) repository rather than in a tarball.  Spack can fetch packages
from VCS repositories. Currently, Spack supports fetching with <a class="reference internal" href="#git-fetch">Git</a>, <a class="reference internal" href="#hg-fetch">Mercurial (hg)</a>, and <a class="reference internal" href="#svn-fetch">Subversion (SVN)</a>.</p>
<p>To fetch a package from a source repository, you add a <code class="docutils literal"><span class="pre">version()</span></code>
call to your package with parameters indicating the repository URL and
any branch, tag, or revision to fetch.  See below for the parameters
you&#8217;ll need for each VCS system.</p>
<div class="section" id="repositories-and-versions">
<h3>Repositories and versions<a class="headerlink" href="#repositories-and-versions" title="Permalink to this headline"></a></h3>
<p>The package author is responsible for coming up with a sensible name
for each version to be fetched from a repository.  For example, if
you&#8217;re fetching from a tag like <code class="docutils literal"><span class="pre">v1.0</span></code>, you might call that <code class="docutils literal"><span class="pre">1.0</span></code>.
If you&#8217;re fetching a nameless git commit or an older subversion
revision, you might give the commit an intuitive name, like <code class="docutils literal"><span class="pre">dev</span></code>
for a development version, or <code class="docutils literal"><span class="pre">some-fancy-new-feature</span></code> if you want
to be more specific.</p>
<p>In general, it&#8217;s recommended to fetch tags or particular
commits/revisions, NOT branches or the repository mainline, as
branches move forward over time and you aren&#8217;t guaranteed to get the
same thing every time you fetch a particular version.  Life isn&#8217;t
always simple, though, so this is not strictly enforced.</p>
<p>In some future release, Spack may support extrapolating repository
versions as it does for tarball URLs, but currently this is not
supported.</p>
</div>
<div class="section" id="git">
<span id="git-fetch"></span><h3>Git<a class="headerlink" href="#git" title="Permalink to this headline"></a></h3>
<p>Git fetching is enabled with the following parameters to <code class="docutils literal"><span class="pre">version</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">git</span></code>: URL of the git repository.</li>
<li><code class="docutils literal"><span class="pre">tag</span></code>: name of a tag to fetch.</li>
<li><code class="docutils literal"><span class="pre">branch</span></code>: name of a branch to fetch.</li>
<li><code class="docutils literal"><span class="pre">commit</span></code>: SHA hash (or prefix) of a commit to fetch.</li>
</ul>
</div></blockquote>
<p>Only one of <code class="docutils literal"><span class="pre">tag</span></code>, <code class="docutils literal"><span class="pre">branch</span></code>, or <code class="docutils literal"><span class="pre">commit</span></code> can be used at a time.</p>
<dl class="docutils">
<dt>Default branch</dt>
<dd><p class="first">To fetch a repository&#8217;s default branch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="s1">&#39;https://github.com/example-project/example.git&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This is not recommended, as the contents of the default branch
change over time.</p>
</dd>
<dt>Tags</dt>
<dd><p class="first">To fetch from a particular tag, use the <code class="docutils literal"><span class="pre">tag</span></code> parameter along with
<code class="docutils literal"><span class="pre">git</span></code>:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;1.0.1&#39;</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="s1">&#39;https://github.com/example-project/example.git&#39;</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;v1.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Branches</dt>
<dd><p class="first">To fetch a particular branch, use <code class="docutils literal"><span class="pre">branch</span></code> instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;experimental&#39;</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="s1">&#39;https://github.com/example-project/example.git&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;experimental&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This is not recommended, as the contents of branches change over
time.</p>
</dd>
<dt>Commits</dt>
<dd><p class="first">Finally, to fetch a particular commit, use <code class="docutils literal"><span class="pre">commit</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;2014-10-08&#39;</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="s1">&#39;https://github.com/example-project/example.git&#39;</span><span class="p">,</span>
        <span class="n">commit</span><span class="o">=</span><span class="s1">&#39;9d38cd4e2c94c3cea97d0e2924814acc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This doesn&#8217;t have to be a full hash; You can abbreviate it as you&#8217;d
expect with git:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;2014-10-08&#39;</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="s1">&#39;https://github.com/example-project/example.git&#39;</span><span class="p">,</span>
        <span class="n">commit</span><span class="o">=</span><span class="s1">&#39;9d38cd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">It may be useful to provide a saner version for commits like this,
e.g. you might use the date as the version, as done above.  Or you
could just use the abbreviated commit hash.  It&#8217;s up to the package
author to decide what makes the most sense.</p>
</dd>
</dl>
<div class="section" id="installing">
<h4>Installing<a class="headerlink" href="#installing" title="Permalink to this headline"></a></h4>
<p>You can fetch and install any of the versions above as you&#8217;d expect,
by using <code class="docutils literal"><span class="pre">&#64;&lt;version&gt;</span></code> in a spec:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack install example@2014-10-08
</pre></div>
</div>
<p>Git and other VCS versions will show up in the list of versions when
a user runs <code class="docutils literal"><span class="pre">spack</span> <span class="pre">info</span> <span class="pre">&lt;package</span> <span class="pre">name&gt;</span></code>.</p>
</div>
</div>
<div class="section" id="mercurial">
<span id="hg-fetch"></span><h3>Mercurial<a class="headerlink" href="#mercurial" title="Permalink to this headline"></a></h3>
<p>Fetching with mercurial works much like <a class="reference external" href="git-fetch">git</a>, but you
use the <code class="docutils literal"><span class="pre">hg</span></code> parameter.</p>
<dl class="docutils">
<dt>Default</dt>
<dd><p class="first">Add the <code class="docutils literal"><span class="pre">hg</span></code> parameter with no <code class="docutils literal"><span class="pre">revision</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;hg-head&#39;</span><span class="p">,</span> <span class="n">hg</span><span class="o">=</span><span class="s1">&#39;https://jay.grs.rwth-aachen.de/hg/example&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Note that this is not recommended; try to fetch a particular
revision instead.</p>
</dd>
<dt>Revisions</dt>
<dd><p class="first">Add <code class="docutils literal"><span class="pre">hg</span></code> and <code class="docutils literal"><span class="pre">revision</span></code> parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">hg</span><span class="o">=</span><span class="s1">&#39;https://jay.grs.rwth-aachen.de/hg/example&#39;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="s1">&#39;v1.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Unlike <code class="docutils literal"><span class="pre">git</span></code>, which has special parameters for different types of
revisions, you can use <code class="docutils literal"><span class="pre">revision</span></code> for branches, tags, and commits
when you fetch with Mercurial.</p>
</dd>
</dl>
<p>As with git, you can fetch these versions using the <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span>
<span class="pre">example&#64;&lt;version&gt;</span></code> command-line syntax.</p>
</div>
<div class="section" id="subversion">
<span id="svn-fetch"></span><h3>Subversion<a class="headerlink" href="#subversion" title="Permalink to this headline"></a></h3>
<p>To fetch with subversion, use the <code class="docutils literal"><span class="pre">svn</span></code> and <code class="docutils literal"><span class="pre">revision</span></code> parameters:</p>
<dl class="docutils">
<dt>Fetching the head</dt>
<dd><p class="first">Simply add an <code class="docutils literal"><span class="pre">svn</span></code> parameter to <code class="docutils literal"><span class="pre">version</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;svn-head&#39;</span><span class="p">,</span> <span class="n">svn</span><span class="o">=</span><span class="s1">&#39;https://outreach.scidac.gov/svn/libmonitor/trunk&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This is not recommended, as the head will move forward over time.</p>
</dd>
<dt>Fetching a revision</dt>
<dd><p class="first">To fetch a particular revision, add a <code class="docutils literal"><span class="pre">revision</span></code> to the
version call:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;svn-head&#39;</span><span class="p">,</span> <span class="n">svn</span><span class="o">=</span><span class="s1">&#39;https://outreach.scidac.gov/svn/libmonitor/trunk&#39;</span><span class="p">,</span>
        <span class="n">revision</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>Subversion branches are handled as part of the directory structure, so
you can check out a branch or tag by changing the <code class="docutils literal"><span class="pre">url</span></code>.</p>
</div>
</div>
<div class="section" id="patches">
<span id="patching"></span><h2>Patches<a class="headerlink" href="#patches" title="Permalink to this headline"></a></h2>
<p>Depending on the host architecture, package version, known bugs, or
other issues, you may need to patch your software to get it to build
correctly.  Like many other package systems, spack allows you to store
patches alongside your package files and apply them to source code
after it&#8217;s downloaded.</p>
<div class="section" id="patch">
<h3><code class="docutils literal"><span class="pre">patch</span></code><a class="headerlink" href="#patch" title="Permalink to this headline"></a></h3>
<p>You can specify patches in your package file with the <code class="docutils literal"><span class="pre">patch()</span></code>
function.  <code class="docutils literal"><span class="pre">patch</span></code> looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mvapich2</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;ad_lustre_rwcontig_open_source.patch&#39;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s1">&#39;@1.9:&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument can be either a URL or a filename.  It specifies a
patch file that should be applied to your source.  If the patch you
supply is a filename, then the patch needs to live within the spack
source tree.  For example, the patch above lives in a directory
structure like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$SPACK_ROOT/var/spack/repos/builtin/packages/
    mvapich2/
        package.py
        ad_lustre_rwcontig_open_source.patch
</pre></div>
</div>
<p>If you supply a URL instead of a filename, the patch will be fetched
from the URL and then applied to your source code.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is generally better to use a filename rather than a URL for your
patch.  Patches fetched from URLs are not currently checksummed,
and adding checksums for them is tedious for the package builder.
File patches go into the spack repository, which gives you git&#8217;s
integrity guarantees.  URL patches may be removed in a future spack
version.</p>
</div>
<p><code class="docutils literal"><span class="pre">patch</span></code> can take two options keyword arguments.  They are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">when</span></code></dt>
<dd>If supplied, this is a spec that tells spack when to apply
the patch.  If the installed package spec matches this spec, the
patch will be applied.  In our example above, the patch is applied
when mvapich is at version <code class="docutils literal"><span class="pre">1.9</span></code> or higher.</dd>
<dt><code class="docutils literal"><span class="pre">level</span></code></dt>
<dd><p class="first">This tells spack how to run the <code class="docutils literal"><span class="pre">patch</span></code> command.  By default,
the level is 1 and spack runs <code class="docutils literal"><span class="pre">patch</span> <span class="pre">-p1</span></code>.  If level is 2,
spack will run <code class="docutils literal"><span class="pre">patch</span> <span class="pre">-p2</span></code>, and so on.</p>
<p>A lot of people are confused by level, so here&#8217;s a primer.  If you
look in your patch file, you may see something like this:</p>
<div class="highlight-diff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gd">--- a/src/mpi/romio/adio/ad_lustre/ad_lustre_rwcontig.c 2013-12-10 12:05:44.806417000 -0800</span>
<span class="gi">+++ b/src/mpi/romio/adio/ad_lustre/ad_lustre_rwcontig.c 2013-12-10 11:53:03.295622000 -0800</span>
<span class="gu">@@ -8,7 +8,7 @@</span>
  *   Copyright (C) 2008 Sun Microsystems, Lustre group
  */

<span class="gd">-#define _XOPEN_SOURCE 600</span>
<span class="gi">+//#define _XOPEN_SOURCE 600</span>
 #include &lt;stdlib.h&gt;
 #include &lt;malloc.h&gt;
 #include &quot;ad_lustre.h&quot;
</pre></div>
</td></tr></table></div>
<p>Lines 1-2 show paths with synthetic <code class="docutils literal"><span class="pre">a/</span></code> and <code class="docutils literal"><span class="pre">b/</span></code> prefixes.  These
are placeholders for the two <code class="docutils literal"><span class="pre">mvapich2</span></code> source directories that
<code class="docutils literal"><span class="pre">diff</span></code> compared when it created the patch file.  This is git&#8217;s
default behavior when creating patch files, but other programs may
behave differently.</p>
<p><code class="docutils literal"><span class="pre">-p1</span></code> strips off the first level of the prefix in both paths,
allowing the patch to be applied from the root of an expanded mvapich2
archive.  If you set level to <code class="docutils literal"><span class="pre">2</span></code>, it would strip off <code class="docutils literal"><span class="pre">src</span></code>, and
so on.</p>
<p class="last">It&#8217;s generally easier to just structure your patch file so that it
applies cleanly with <code class="docutils literal"><span class="pre">-p1</span></code>, but if you&#8217;re using a patch you didn&#8217;t
create yourself, <code class="docutils literal"><span class="pre">level</span></code> can be handy.</p>
</dd>
</dl>
</div>
<div class="section" id="patch-functions">
<h3><code class="docutils literal"><span class="pre">patch()</span></code> functions<a class="headerlink" href="#patch-functions" title="Permalink to this headline"></a></h3>
<p>In addition to supplying patch files, you can write a custom function
to patch a package&#8217;s source.  For example, the <code class="docutils literal"><span class="pre">py-pyside</span></code> package
contains some custom code for tweaking the way the PySide build
handles <code class="docutils literal"><span class="pre">RPATH</span></code>:</p>
<div class="highlight-python" id="pyside-patch"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PyPyside</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Undo PySide RPATH handling and add Spack RPATH.&quot;&quot;&quot;</span>
        <span class="c1"># Figure out the special RPATH</span>
        <span class="n">pypkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">package</span>
        <span class="n">rpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpath</span>
        <span class="n">rpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="n">pypkg</span><span class="o">.</span><span class="n">site_packages_dir</span><span class="p">,</span> <span class="s1">&#39;PySide&#39;</span><span class="p">))</span>

        <span class="c1"># Add Spack&#39;s standard CMake args to the sub-builds.</span>
        <span class="c1"># They&#39;re called BY setup.py so we have to patch it.</span>
        <span class="n">filter_file</span><span class="p">(</span>
            <span class="s1">r&#39;OPTION_CMAKE,&#39;</span><span class="p">,</span>
            <span class="s1">r&#39;OPTION_CMAKE, &#39;</span> <span class="o">+</span> <span class="p">(</span>
                <span class="s1">&#39;&quot;-DCMAKE_INSTALL_RPATH_USE_LINK_PATH=FALSE&quot;, &#39;</span>
                <span class="s1">&#39;&quot;-DCMAKE_INSTALL_RPATH=</span><span class="si">%s</span><span class="s1">&quot;,&#39;</span> <span class="o">%</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rpath</span><span class="p">)),</span>
            <span class="s1">&#39;setup.py&#39;</span><span class="p">)</span>

        <span class="c1"># PySide tries to patch ELF files to remove RPATHs</span>
        <span class="c1"># Disable this and go with the one we set.</span>
        <span class="n">filter_file</span><span class="p">(</span>
            <span class="s1">r&#39;^\s*rpath_cmd\(pyside_path, srcpath\)&#39;</span><span class="p">,</span>
            <span class="s1">r&#39;#rpath_cmd(pyside_path, srcpath)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pyside_postinstall.py&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>A <code class="docutils literal"><span class="pre">patch</span></code> function, if present, will be run after patch files are
applied and before <code class="docutils literal"><span class="pre">install()</span></code> is run.</p>
<p>You could put this logic in <code class="docutils literal"><span class="pre">install()</span></code>, but putting it in a patch
function gives you some benefits.  First, spack ensures that the
<code class="docutils literal"><span class="pre">patch()</span></code> function is run once per code checkout.  That means that
if you run install, hit ctrl-C, and run install again, the code in the
patch function is only run once.  Also, you can tell Spack to run only
the patching part of the build using the <a class="reference internal" href="#spack-patch"><span>spack patch</span></a> command.</p>
</div>
</div>
<div class="section" id="handling-rpaths">
<h2>Handling RPATHs<a class="headerlink" href="#handling-rpaths" title="Permalink to this headline"></a></h2>
<p>Spack installs each package in a way that ensures that all of its
dependencies are found when it runs.  It does this using <a class="reference external" href="http://en.wikipedia.org/wiki/Rpath">RPATHs</a>.  An RPATH is a search
path, stored in a binary (an executable or library), that tells the
dynamic loader where to find its dependencies at runtime. You may be
familiar with <code class="docutils literal"><span class="pre">`LD_LIBRARY_PATH</span></code>
&lt;<a class="reference external" href="http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html">http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html</a>&gt;`_
on Linux or <code class="docutils literal"><span class="pre">`DYLD_LIBRARY_PATH</span></code>
&lt;<a class="reference external" href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/dyld.1.html">https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/dyld.1.html</a>&gt;`
on Mac OS X.  RPATH is similar to these paths, in that it tells
the loader where to find libraries.  Unlike them, it is embedded in
the binary and not set in each user&#8217;s environment.</p>
<p>RPATHs in Spack are handled in one of three ways:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">For most packages, RPATHs are handled automatically using Spack&#8217;s
<a class="reference internal" href="#compiler-wrappers"><span>compiler wrappers</span></a>.  These wrappers are
set in standard variables like <code class="docutils literal"><span class="pre">CC</span></code>, <code class="docutils literal"><span class="pre">CXX</span></code>, and <code class="docutils literal"><span class="pre">FC</span></code>, so
most build systems (autotools and many gmake systems) pick them
up and use them.</p>
</li>
<li><p class="first">CMake also respects Spack&#8217;s compiler wrappers, but many CMake
builds have logic to overwrite RPATHs when binaries are
installed. Spack provides the <code class="docutils literal"><span class="pre">std_cmake_args</span></code> variable, which
includes parameters necessary for CMake build use the right
installation RPATH.  It can be used like this when <code class="docutils literal"><span class="pre">cmake</span></code> is
invoked:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPackage</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">cmake</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">std_cmake_args</span><span class="p">)</span>
        <span class="n">make</span><span class="p">()</span>
        <span class="n">make</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">If you need to modify the build to add your own RPATHs, you can
use the <code class="docutils literal"><span class="pre">self.rpath</span></code> property of your package, which will
return a list of all the RPATHs that Spack will use when it
links.  You can see this how this is used in the <a class="reference internal" href="#pyside-patch"><span>PySide
example</span></a> above.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="finding-new-versions">
<h2>Finding new versions<a class="headerlink" href="#finding-new-versions" title="Permalink to this headline"></a></h2>
<p>You&#8217;ve already seen the <code class="docutils literal"><span class="pre">homepage</span></code> and <code class="docutils literal"><span class="pre">url</span></code> package attributes:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spack</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Mpich</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;MPICH is a high performance and widely portable implementation of</span>
<span class="sd">      the Message Passing Interface (MPI) standard.&quot;&quot;&quot;</span>
   <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.mpich.org&quot;</span>
   <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.mpich.org/static/downloads/3.0.4/mpich-3.0.4.tar.gz&quot;</span>
</pre></div>
</td></tr></table></div>
<p>These are class-level attributes used by Spack to show users
information about the package, and to determine where to download its
source code.</p>
<p>Spack uses the tarball URL to extrapolate where to find other tarballs
of the same package (e.g. in <a class="reference internal" href="#spack-checksum">spack checksum</a>, but
this does not always work.  This section covers ways you can tell
Spack to find tarballs elsewhere.</p>
<div class="section" id="list-url">
<span id="attribute-list-url"></span><h3><code class="docutils literal"><span class="pre">list_url</span></code><a class="headerlink" href="#list-url" title="Permalink to this headline"></a></h3>
<p>When spack tries to find available versions of packages (e.g. with
<a class="reference internal" href="#spack-checksum">spack checksum</a>), it spiders the parent directory
of the tarball in the <code class="docutils literal"><span class="pre">url</span></code> attribute.  For example, for libelf, the
url is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://www.mr511.de/software/libelf-0.8.13.tar.gz&quot;</span>
</pre></div>
</div>
<p>Here, Spack spiders <code class="docutils literal"><span class="pre">http://www.mr511.de/software/</span></code> to find similar
tarball links and ultimately to make a list of available versions of
<code class="docutils literal"><span class="pre">libelf</span></code>.</p>
<p>For many packages, the tarball&#8217;s parent directory may be unlistable,
or it may not contain any links to source code archives.  In fact,
many times additional package downloads aren&#8217;t even available in the
same directory as the download URL.</p>
<p>For these, you can specify a separate <code class="docutils literal"><span class="pre">list_url</span></code> indicating the page
to search for tarballs.  For example, <code class="docutils literal"><span class="pre">libdwarf</span></code> has the homepage as
the <code class="docutils literal"><span class="pre">list_url</span></code>, because that is where links to old versions are:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Libdwarf</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.prevanders.net/dwarf.html&quot;</span>
    <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.prevanders.net/libdwarf-20130729.tar.gz&quot;</span>
    <span class="n">list_url</span> <span class="o">=</span> <span class="n">homepage</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="list-depth">
<span id="attribute-list-depth"></span><h3><code class="docutils literal"><span class="pre">list_depth</span></code><a class="headerlink" href="#list-depth" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">libdwarf</span></code> and many other packages have a listing of available
versions on a single webpage, but not all do.  For example, <code class="docutils literal"><span class="pre">mpich</span></code>
has a tarball URL that looks like this:</p>
<blockquote>
<div>url = &#8220;<a class="reference external" href="http://www.mpich.org/static/downloads/3.0.4/mpich-3.0.4.tar.gz">http://www.mpich.org/static/downloads/3.0.4/mpich-3.0.4.tar.gz</a>&#8220;</div></blockquote>
<p>But its downloads are in many different subdirectories of
<code class="docutils literal"><span class="pre">http://www.mpich.org/static/downloads/</span></code>.  So, we need to add a
<code class="docutils literal"><span class="pre">list_url</span></code> <em>and</em> a <code class="docutils literal"><span class="pre">list_depth</span></code> attribute:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mpich</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">homepage</span>   <span class="o">=</span> <span class="s2">&quot;http://www.mpich.org&quot;</span>
    <span class="n">url</span>        <span class="o">=</span> <span class="s2">&quot;http://www.mpich.org/static/downloads/3.0.4/mpich-3.0.4.tar.gz&quot;</span>
    <span class="n">list_url</span>   <span class="o">=</span> <span class="s2">&quot;http://www.mpich.org/static/downloads/&quot;</span>
    <span class="n">list_depth</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</td></tr></table></div>
<p>By default, Spack only looks at the top-level page available at
<code class="docutils literal"><span class="pre">list_url</span></code>.  <code class="docutils literal"><span class="pre">list_depth</span></code> tells it to follow up to 2 levels of
links from the top-level page.  Note that here, this implies two
levels of subdirectories, as the <code class="docutils literal"><span class="pre">mpich</span></code> website is structured much
like a filesystem.  But <code class="docutils literal"><span class="pre">list_depth</span></code> really refers to link depth
when spidering the page.</p>
</div>
</div>
<div class="section" id="parallel-builds">
<span id="attribute-parallel"></span><h2>Parallel builds<a class="headerlink" href="#parallel-builds" title="Permalink to this headline"></a></h2>
<p>By default, Spack will invoke <code class="docutils literal"><span class="pre">make()</span></code> with a <code class="docutils literal"><span class="pre">-j</span> <span class="pre">&lt;njobs&gt;</span></code>
argument, so that builds run in parallel.  It figures out how many
jobs to run by determining how many cores are on the host machine.
Specifically, it uses the number of CPUs reported by Python&#8217;s
<a class="reference external" href="http://docs.python.org/library/multiprocessing.html#multiprocessing.cpu_count">multiprocessing.cpu_count()</a>.</p>
<p>If a package does not build properly in parallel, you can override
this setting by adding <code class="docutils literal"><span class="pre">parallel</span> <span class="pre">=</span> <span class="pre">False</span></code> to your package.  For
example, OpenSSL&#8217;s build does not work in parallel, so its package
looks like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Openssl</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.openssl.org&quot;</span>
    <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.openssl.org/source/openssl-1.0.1h.tar.gz&quot;</span>

    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;1.0.1h&#39;</span><span class="p">,</span> <span class="s1">&#39;8d6d684a9430d5cc98a62a5d8fbda8cf&#39;</span><span class="p">)</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;zlib&quot;</span><span class="p">)</span>

<span class="hll">    <span class="n">parallel</span> <span class="o">=</span> <span class="bp">False</span>
</span></pre></div>
</td></tr></table></div>
<p>Similarly, you can disable parallel builds only for specific make
commands, as <code class="docutils literal"><span class="pre">libdwarf</span></code> does:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Libelf</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                  <span class="s2">&quot;--enable-shared&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;--disable-dependency-tracking&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;--disable-debug&quot;</span><span class="p">)</span>
<span class="hll">        <span class="n">make</span><span class="p">()</span>
</span>
        <span class="c1"># The mkdir commands in libelf&#39;s install can fail in parallel</span>
<span class="hll">        <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The first make will run in parallel here, but the second will not.  If
you set <code class="docutils literal"><span class="pre">parallel</span></code> to <code class="docutils literal"><span class="pre">False</span></code> at the package level, then each call
to <code class="docutils literal"><span class="pre">make()</span></code> will be sequential by default, but packagers can call
<code class="docutils literal"><span class="pre">make(parallel=True)</span></code> to override it.</p>
</div>
<div class="section" id="dependencies">
<span id="id7"></span><h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline"></a></h2>
<p>We&#8217;ve covered how to build a simple package, but what if one package
relies on another package to build?  How do you express that in a
package file?  And how do you refer to the other package in the build
script for your own package?</p>
<p>Spack makes this relatively easy.  Let&#8217;s take a look at the
<code class="docutils literal"><span class="pre">libdwarf</span></code> package to see how it&#8217;s done:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Libdwarf</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;http://www.prevanders.net/dwarf.html&quot;</span>
    <span class="n">url</span>      <span class="o">=</span> <span class="s2">&quot;http://www.prevanders.net/libdwarf-20130729.tar.gz&quot;</span>
    <span class="n">list_url</span> <span class="o">=</span> <span class="n">homepage</span>

    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;20130729&#39;</span><span class="p">,</span> <span class="s1">&#39;4cc5e48693f7b93b7aa0261e63c0e21d&#39;</span><span class="p">)</span>
    <span class="o">...</span>

<span class="hll">    <span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;libelf&quot;</span><span class="p">)</span>
</span>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="depends-on">
<h3><code class="docutils literal"><span class="pre">depends_on()</span></code><a class="headerlink" href="#depends-on" title="Permalink to this headline"></a></h3>
<p>The highlighted <code class="docutils literal"><span class="pre">depends_on('libelf')</span></code> call tells Spack that it
needs to build and install the <code class="docutils literal"><span class="pre">libelf</span></code> package before it builds
<code class="docutils literal"><span class="pre">libdwarf</span></code>.  This means that in your <code class="docutils literal"><span class="pre">install()</span></code> method, you are
guaranteed that <code class="docutils literal"><span class="pre">libelf</span></code> has been built and installed successfully,
so you can rely on it for your libdwarf build.</p>
</div>
<div class="section" id="dependency-specs">
<h3>Dependency specs<a class="headerlink" href="#dependency-specs" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">depends_on</span></code> doesn&#8217;t just take the name of another package.  It
takes a full spec.  This means that you can restrict the versions or
other configuration options of <code class="docutils literal"><span class="pre">libelf</span></code> that <code class="docutils literal"><span class="pre">libdwarf</span></code> will build
with.  Here&#8217;s an example.  Suppose that in the <code class="docutils literal"><span class="pre">libdwarf</span></code> package
you write:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;libelf@0.8:&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now <code class="docutils literal"><span class="pre">libdwarf</span></code> will require a version of <code class="docutils literal"><span class="pre">libelf</span></code> version <code class="docutils literal"><span class="pre">0.8</span></code>
or higher in order to build.  If some versions of <code class="docutils literal"><span class="pre">libelf</span></code> are
installed but they are all older than this, then Spack will build a
new version of <code class="docutils literal"><span class="pre">libelf</span></code> that satisfies the spec&#8217;s version
constraint, and it will build <code class="docutils literal"><span class="pre">libdwarf</span></code> with that one.  You could
just as easily provide a version range:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;libelf@0.8.2:0.8.4:&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or a requirement for a particular variant:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;libelf@0.8+debug&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Both users <em>and</em> package authors can use the same spec syntax to refer
to different package configurations.  Users use the spec syntax on the
command line to find installed packages or to install packages with
particular constraints, and package authors can use specs to describe
relationships between packages.</p>
</div>
<div class="section" id="setup-dependent-environment">
<span id="id8"></span><h3><code class="docutils literal"><span class="pre">setup_dependent_environment()</span></code><a class="headerlink" href="#setup-dependent-environment" title="Permalink to this headline"></a></h3>
<p>Spack provides a mechanism for dependencies to provide variables that
can be used in their dependents&#8217; build.  Any package can declare a
<code class="docutils literal"><span class="pre">setup_dependent_environment()</span></code> function, and this function will be
called before the <code class="docutils literal"><span class="pre">install()</span></code> method of any dependent packages.
This allows dependencies to set up environment variables and other
properties to be used by dependents.</p>
<p>The function declaration should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Qt</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">setup_dependent_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">dep_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dependencies of Qt find it using the QTDIR environment variable.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;QTDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
</pre></div>
</div>
<p>Here, the Qt package sets the <code class="docutils literal"><span class="pre">QTDIR</span></code> environment variable so that
packages that depend on a particular Qt installation will find it.</p>
<p>The arguments to this function are:</p>
<blockquote>
<div><ul class="simple">
<li><strong>module</strong>: the module of the dependent package, where global
properties can be assigned.</li>
<li><strong>spec</strong>: the spec of the <em>dependency package</em> (the one the function is called on).</li>
<li><strong>dep_spec</strong>: the spec of the dependent package (i.e. dep_spec depends on spec).</li>
</ul>
</div></blockquote>
<p>A good example of using these is in the Python package:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup_dependent_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">dep_spec</span><span class="p">):</span>
    <span class="c1"># Python extension builds can have a global python executable function</span>
    <span class="n">module</span><span class="o">.</span><span class="n">python</span> <span class="o">=</span> <span class="n">Executable</span><span class="p">(</span><span class="n">join_path</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">))</span>

    <span class="c1"># Add variables for lib/pythonX.Y and lib/pythonX.Y/site-packages dirs.</span>
    <span class="n">module</span><span class="o">.</span><span class="n">python_lib_dir</span>     <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dep_spec</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib_dir</span><span class="p">)</span>
    <span class="n">module</span><span class="o">.</span><span class="n">python_include_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dep_spec</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_include_dir</span><span class="p">)</span>
    <span class="n">module</span><span class="o">.</span><span class="n">site_packages_dir</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dep_spec</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_packages_dir</span><span class="p">)</span>

    <span class="c1"># Make the site packages directory if it does not exist already.</span>
    <span class="n">mkdirp</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">site_packages_dir</span><span class="p">)</span>

    <span class="c1"># Set PYTHONPATH to include site-packages dir for the</span>
    <span class="c1"># extension and any other python extensions it depends on.</span>
    <span class="n">python_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dep_spec</span><span class="o">.</span><span class="n">traverse</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">package</span><span class="o">.</span><span class="n">extends</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">):</span>
            <span class="n">python_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_packages_dir</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">python_paths</span><span class="p">)</span>
</pre></div>
</div>
<p>The first thing that happens here is that the <code class="docutils literal"><span class="pre">python</span></code> command is
inserted into module scope of the dependent.  This allows most python
packages to have a very simple install method, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">python</span><span class="p">(</span><span class="s1">&#39;setup.py&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;--prefix=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
<p>Python&#8217;s <code class="docutils literal"><span class="pre">setup_dependent_environment</span></code> method also sets up some
other variables, creates a directory, and sets up the <code class="docutils literal"><span class="pre">PYTHONPATH</span></code>
so that dependent packages can find their dependencies at build time.</p>
</div>
</div>
<div class="section" id="extensions">
<span id="packaging-extensions"></span><h2>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline"></a></h2>
<p>Spack&#8217;s support for package extensions is documented extensively in
<a class="reference internal" href="basic_usage.html#extensions"><span>Extensions &amp; Python support</span></a>.  This section documents how to make your own
extendable packages and extensions.</p>
<p>To support extensions, a package needs to set its <code class="docutils literal"><span class="pre">extendable</span></code>
property to <code class="docutils literal"><span class="pre">True</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Python</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">extendable</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>To make a package into an extension, simply add simply add an
<code class="docutils literal"><span class="pre">extends</span></code> call in the package definition, and pass it the name of an
extendable package:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PyNumpy</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">extends</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Now, the <code class="docutils literal"><span class="pre">py-numpy</span></code> package can be used as an argument to <code class="docutils literal"><span class="pre">spack</span>
<span class="pre">activate</span></code>.  When it is activated, all the files in its prefix will be
symbolically linked into the prefix of the python package.</p>
<p>Sometimes, certain files in one package will conflict with those in
another, which means they cannot both be activated (symlinked) at the
same time.  In this case, you can tell Spack to ignore those files
when it does the activation:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PyNose</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">extends</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="s1">r&#39;bin/nosetests.*$&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The code above will prevent <code class="docutils literal"><span class="pre">$prefix/bin/nosetests</span></code> from being
linked in at activation time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can call <em>either</em> <code class="docutils literal"><span class="pre">depends_on</span></code> or <code class="docutils literal"><span class="pre">extends</span></code> on any one
package, but not both.  For example you cannot both
<code class="docutils literal"><span class="pre">depends_on('python')</span></code> and <code class="docutils literal"><span class="pre">extends(python)</span></code> in the same
package.  <code class="docutils literal"><span class="pre">extends</span></code> implies <code class="docutils literal"><span class="pre">depends_on</span></code>.</p>
</div>
<div class="section" id="activation-deactivation">
<h3>Activation &amp; deactivation<a class="headerlink" href="#activation-deactivation" title="Permalink to this headline"></a></h3>
<p>Spack&#8217;s <code class="docutils literal"><span class="pre">Package</span></code> class has default <code class="docutils literal"><span class="pre">activate</span></code> and <code class="docutils literal"><span class="pre">deactivate</span></code>
implementations that handle symbolically linking extensions&#8217; prefixes
into the directory of the parent package.  However, extendable
packages can override these methods to add custom activate/deactivate
logic of their own.  For example, the <code class="docutils literal"><span class="pre">activate</span></code> and <code class="docutils literal"><span class="pre">deactivate</span></code>
methods in the Python class use the symbolic linking, but they also
handle details surrounding Python&#8217;s <code class="docutils literal"><span class="pre">.pth</span></code> files, and other aspects
of Python packaging.</p>
<p>Spack&#8217;s extensions mechanism is designed to be extensible, so that
other packages (like Ruby, R, Perl, etc.)  can provide their own
custom extension management logic, as they may not handle modules the
same way that Python does.</p>
<p>Let&#8217;s look at Python&#8217;s activate function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext_pkg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">python_ignore</span><span class="p">(</span><span class="n">ext_pkg</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Python</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">ext_pkg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">exts</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">install_layout</span><span class="o">.</span><span class="n">extension_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">exts</span><span class="p">[</span><span class="n">ext_pkg</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext_pkg</span><span class="o">.</span><span class="n">spec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_easy_install_pth</span><span class="p">(</span><span class="n">exts</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called on the <em>extendee</em> (Python).  It first calls
<code class="docutils literal"><span class="pre">activate</span></code> in the superclass, which handles symlinking the
extension package&#8217;s prefix into this package&#8217;s prefix.  It then does
some special handling of the <code class="docutils literal"><span class="pre">easy-install.pth</span></code> file, part of
Python&#8217;s setuptools.</p>
<p>Deactivate behaves similarly to activate, but it unlinks files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext_pkg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">python_ignore</span><span class="p">(</span><span class="n">ext_pkg</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Python</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="n">ext_pkg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">exts</span> <span class="o">=</span> <span class="n">spack</span><span class="o">.</span><span class="n">install_layout</span><span class="o">.</span><span class="n">extension_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext_pkg</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">:</span>     <span class="c1"># Make deactivate idempotent.</span>
        <span class="k">del</span> <span class="n">exts</span><span class="p">[</span><span class="n">ext_pkg</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_easy_install_pth</span><span class="p">(</span><span class="n">exts</span><span class="p">)</span>
</pre></div>
</div>
<p>Both of these methods call some custom functions in the Python
package.  See the source for Spack&#8217;s Python package for details.</p>
</div>
<div class="section" id="activation-arguments">
<h3>Activation arguments<a class="headerlink" href="#activation-arguments" title="Permalink to this headline"></a></h3>
<p>You may have noticed that the <code class="docutils literal"><span class="pre">activate</span></code> function defined above
takes keyword arguments.  These are the keyword arguments from
<code class="docutils literal"><span class="pre">extends()</span></code>, and they are passed to both activate and deactivate.</p>
<p>This capability allows an extension to customize its own activation by
passing arguments to the extendee.  Extendees can likewise implement
custom <code class="docutils literal"><span class="pre">activate()</span></code> and <code class="docutils literal"><span class="pre">deactivate()</span></code> functions to suit their
needs.</p>
<p>The only keyword argument supported by default is the <code class="docutils literal"><span class="pre">ignore</span></code>
argument, which can take a regex, list of regexes, or a predicate to
determine which files <em>not</em> to symlink during activation.</p>
</div>
</div>
<div class="section" id="virtual-dependencies">
<span id="id9"></span><h2>Virtual dependencies<a class="headerlink" href="#virtual-dependencies" title="Permalink to this headline"></a></h2>
<p>In some cases, more than one package can satisfy another package&#8217;s
dependency.  One way this can happen is if a package depends on a
particular <em>interface</em>, but there are multiple <em>implementations</em> of
the interface, and the package could be built with any of them.  A
<em>very</em> common interface in HPC is the <a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpi/">Message Passing Interface (MPI)</a>, which is used in
many large-scale parallel applications.</p>
<p>MPI has several different implementations (e.g., <a class="reference external" href="http://www.mpich.org">MPICH</a>, <a class="reference external" href="http://www.open-mpi.org">OpenMPI</a>, and
<a class="reference external" href="http://mvapich.cse.ohio-state.edu">MVAPICH</a>) and scientific
applications can be built with any one of them.  Complicating matters,
MPI does not have a standardized ABI, so a package built with one
implementation cannot simply be relinked with another implementation.
Many package managers handle interfaces like this by requiring many
similar package files, e.g., <code class="docutils literal"><span class="pre">foo</span></code>, <code class="docutils literal"><span class="pre">foo-mvapich</span></code>, <code class="docutils literal"><span class="pre">foo-mpich</span></code>,
but Spack avoids this explosion of package files by providing support
for <em>virtual dependencies</em>.</p>
<div class="section" id="provides">
<h3><code class="docutils literal"><span class="pre">provides</span></code><a class="headerlink" href="#provides" title="Permalink to this headline"></a></h3>
<p>In Spack, <code class="docutils literal"><span class="pre">mpi</span></code> is handled as a <em>virtual package</em>.  A package like
<code class="docutils literal"><span class="pre">mpileaks</span></code> can depend on it just like any other package, by
supplying a <code class="docutils literal"><span class="pre">depends_on</span></code> call in the package definition.  For example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mpileaks</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/hpc/mpileaks&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/hpc/mpileaks/releases/download/v1.0/mpileaks-1.0.tar.gz&quot;</span>

    <span class="n">version</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="s1">&#39;8838c574b39202a57d7c2d68692718aa&#39;</span><span class="p">)</span>

<span class="hll">    <span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;mpi&quot;</span><span class="p">)</span>
</span>    <span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;adept-utils&quot;</span><span class="p">)</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="s2">&quot;callpath&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Here, <code class="docutils literal"><span class="pre">callpath</span></code> and <code class="docutils literal"><span class="pre">adept-utils</span></code> are concrete packages, but
there is no actual package file for <code class="docutils literal"><span class="pre">mpi</span></code>, so we say it is a
<em>virtual</em> package.  The syntax of <code class="docutils literal"><span class="pre">depends_on</span></code>, is the same for
both.  If we look inside the package file of an MPI implementation,
say MPICH, we&#8217;ll see something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mpich</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="n">provides</span><span class="p">(</span><span class="s1">&#39;mpi&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">provides(&quot;mpi&quot;)</span></code> call tells Spack that the <code class="docutils literal"><span class="pre">mpich</span></code> package
can be used to satisfy the dependency of any package that
<code class="docutils literal"><span class="pre">depends_on('mpi')</span></code>.</p>
</div>
<div class="section" id="versioned-interfaces">
<h3>Versioned Interfaces<a class="headerlink" href="#versioned-interfaces" title="Permalink to this headline"></a></h3>
<p>Just as you can pass a spec to <code class="docutils literal"><span class="pre">depends_on</span></code>, so can you pass a spec
to <code class="docutils literal"><span class="pre">provides</span></code> to add constraints.  This allows Spack to support the
notion of <em>versioned interfaces</em>.  The MPI standard has gone through
many revisions, each with new functions added, and each revision of
the standard has a version number.  Some packages may require a recent
implementation that supports MPI-3 functions, but some MPI versions may
only provide up to MPI-2.  Others may need MPI 2.1 or higher.  You can
indicate this by adding a version constraint to the spec passed to
<code class="docutils literal"><span class="pre">provides</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">provides</span><span class="p">(</span><span class="s2">&quot;mpi@:2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Suppose that the above <code class="docutils literal"><span class="pre">provides</span></code> call is in the <code class="docutils literal"><span class="pre">mpich2</span></code> package.
This says that <code class="docutils literal"><span class="pre">mpich2</span></code> provides MPI support <em>up to</em> version 2, but
if a package <code class="docutils literal"><span class="pre">depends_on(&quot;mpi&#64;3&quot;)</span></code>, then Spack will <em>not</em> build that
package with <code class="docutils literal"><span class="pre">mpich2</span></code>.</p>
</div>
<div class="section" id="provides-when">
<h3><code class="docutils literal"><span class="pre">provides</span> <span class="pre">when</span></code><a class="headerlink" href="#provides-when" title="Permalink to this headline"></a></h3>
<p>The same package may provide different versions of an interface
depending on <em>its</em> version.  Above, we simplified the <code class="docutils literal"><span class="pre">provides</span></code>
call in <code class="docutils literal"><span class="pre">mpich</span></code> to make the explanation easier.  In reality, this is
how <code class="docutils literal"><span class="pre">mpich</span></code> calls <code class="docutils literal"><span class="pre">provides</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">provides</span><span class="p">(</span><span class="s1">&#39;mpi@:3&#39;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s1">&#39;@3:&#39;</span><span class="p">)</span>
<span class="n">provides</span><span class="p">(</span><span class="s1">&#39;mpi@:1&#39;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s1">&#39;@1:&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">when</span></code> argument to <code class="docutils literal"><span class="pre">provides</span></code> allows you to specify optional
constraints on the <em>providing</em> package, or the <em>provider</em>.  The
provider only provides the declared virtual spec when <em>it</em> matches
the constraints in the when clause.  Here, when <code class="docutils literal"><span class="pre">mpich</span></code> is at
version 3 or higher, it provides MPI up to version 3.  When <code class="docutils literal"><span class="pre">mpich</span></code>
is at version 1 or higher, it provides the MPI virtual package at
version 1.</p>
<p>The <code class="docutils literal"><span class="pre">when</span></code> qualifier ensures that Spack selects a suitably high
version of <code class="docutils literal"><span class="pre">mpich</span></code> to satisfy some other package that <code class="docutils literal"><span class="pre">depends_on</span></code>
a particular version of MPI.  It will also prevent a user from
building with too low a version of <code class="docutils literal"><span class="pre">mpich</span></code>.  For example, suppose
the package <code class="docutils literal"><span class="pre">foo</span></code> declares this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="s1">&#39;mpi@2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Suppose a user invokes <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> like this:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack install foo ^mpich@1.0
</pre></div>
</div>
<p>Spack will fail with a constraint violation, because the version of
MPICH requested is too low for the <code class="docutils literal"><span class="pre">mpi</span></code> requirement in <code class="docutils literal"><span class="pre">foo</span></code>.</p>
</div>
</div>
<div class="section" id="abstract-concrete-specs">
<span id="abstract-and-concrete"></span><h2>Abstract &amp; concrete specs<a class="headerlink" href="#abstract-concrete-specs" title="Permalink to this headline"></a></h2>
<p>Now that we&#8217;ve seen how spec constraints can be specified <a class="reference internal" href="basic_usage.html#sec-specs"><span>on the
command line</span></a> and within package definitions, we can talk
about how Spack puts all of this information together.  When you run
this:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack install mpileaks ^callpath@1.0+debug ^libelf@0.8.11
</pre></div>
</div>
<p>Spack parses the command line and builds a spec from the description.
The spec says that <code class="docutils literal"><span class="pre">mpileaks</span></code> should be built with the <code class="docutils literal"><span class="pre">callpath</span></code>
library at 1.0 and with the debug option enabled, and with <code class="docutils literal"><span class="pre">libelf</span></code>
version 0.8.11.  Spack will also look at the <code class="docutils literal"><span class="pre">depends_on</span></code> calls in
all of these packages, and it will build a spec from that.  The specs
from the command line and the specs built from package descriptions
are then combined, and the constraints are checked against each other
to make sure they&#8217;re satisfiable.</p>
<p>What we have after this is done is called an <em>abstract spec</em>.  An
abstract spec is partially specified.  In other words, it could
describe more than one build of a package.  Spack does this to make
things easier on the user: they should only have to specify as much of
the package spec as they care about.  Here&#8217;s an example partial spec
DAG, based on the constraints above:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mpileaks
    ^callpath@1.0+debug
        ^dyninst
            ^libdwarf
                ^libelf@0.8.11
        ^mpi
</pre></div>
</div>
<p class="graphviz">
<object data="_images/graphviz-fe798530a7209ae8f70d244ccaa099e4a5c27e30.svg" type="image/svg+xml">
            <p class="warning">digraph {
    mpileaks -&gt; mpi
    mpileaks -&gt; &quot;callpath&#64;1.0+debug&quot; -&gt; mpi
    &quot;callpath&#64;1.0+debug&quot; -&gt; dyninst
    dyninst  -&gt; libdwarf -&gt; &quot;libelf&#64;0.8.11&quot;
    dyninst  -&gt; &quot;libelf&#64;0.8.11&quot;
}</p></object>
</p>
<p>This diagram shows a spec DAG output as a tree, where successive
levels of indentation represent a depends-on relationship.  In the
above DAG, we can see some packages annotated with their constraints,
and some packages with no annotations at all.  When there are no
annotations, it means the user doesn&#8217;t care what configuration of that
package is built, just so long as it works.</p>
<div class="section" id="concretization">
<h3>Concretization<a class="headerlink" href="#concretization" title="Permalink to this headline"></a></h3>
<p>An abstract spec is useful for the user, but you can&#8217;t install an
abstract spec.  Spack has to take the abstract spec and &#8220;fill in&#8221; the
remaining unspecified parts in order to install.  This process is
called <strong>concretization</strong>.  Concretization happens in between the time
the user runs <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> and the time the <code class="docutils literal"><span class="pre">install()</span></code> method
is called.  The concretized version of the spec above might look like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mpileaks@2.3%gcc@4.7.3=linux-ppc64
    ^callpath@1.0%gcc@4.7.3+debug=linux-ppc64
        ^dyninst@8.1.2%gcc@4.7.3=linux-ppc64
            ^libdwarf@20130729%gcc@4.7.3=linux-ppc64
                ^libelf@0.8.11%gcc@4.7.3=linux-ppc64
        ^mpich@3.0.4%gcc@4.7.3=linux-ppc64
</pre></div>
</div>
<p class="graphviz">
<object data="_images/graphviz-08fbea45438f74370f9c6aecbcda0f89f6090ab3.svg" type="image/svg+xml">
            <p class="warning">digraph {
    &quot;mpileaks&#64;2.3\n%gcc&#64;4.7.3\n=linux-ppc64&quot; -&gt; &quot;mpich&#64;3.0.4\n%gcc&#64;4.7.3\n=linux-ppc64&quot;
    &quot;mpileaks&#64;2.3\n%gcc&#64;4.7.3\n=linux-ppc64&quot; -&gt; &quot;callpath&#64;1.0\n%gcc&#64;4.7.3+debug\n=linux-ppc64&quot; -&gt; &quot;mpich&#64;3.0.4\n%gcc&#64;4.7.3\n=linux-ppc64&quot;
    &quot;callpath&#64;1.0\n%gcc&#64;4.7.3+debug\n=linux-ppc64&quot; -&gt; &quot;dyninst&#64;8.1.2\n%gcc&#64;4.7.3\n=linux-ppc64&quot;
    &quot;dyninst&#64;8.1.2\n%gcc&#64;4.7.3\n=linux-ppc64&quot; -&gt; &quot;libdwarf&#64;20130729\n%gcc&#64;4.7.3\n=linux-ppc64&quot; -&gt; &quot;libelf&#64;0.8.11\n%gcc&#64;4.7.3\n=linux-ppc64&quot;
    &quot;dyninst&#64;8.1.2\n%gcc&#64;4.7.3\n=linux-ppc64&quot; -&gt; &quot;libelf&#64;0.8.11\n%gcc&#64;4.7.3\n=linux-ppc64&quot;
}</p></object>
</p>
<p>Here, all versions, compilers, and platforms are filled in, and there
is a single version (no version ranges) for each package.  All
decisions about configuration have been made, and only after this
point will Spack call the <code class="docutils literal"><span class="pre">install()</span></code> method for your package.</p>
<p>Concretization in Spack is based on certain selection policies that
tell Spack how to select, e.g., a version, when one is not specified
explicitly.  Concretization policies are discussed in more detail in
<a class="reference internal" href="site_configuration.html#site-configuration"><span>Site configuration</span></a>.  Sites using Spack can customize them to
match the preferences of their own users.</p>
</div>
<div class="section" id="spack-spec">
<span id="id10"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">spec</span></code><a class="headerlink" href="#spack-spec" title="Permalink to this headline"></a></h3>
<p>For an arbitrary spec, you can see the result of concretization by
running <code class="docutils literal"><span class="pre">spack</span> <span class="pre">spec</span></code>.  For example:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack spec dyninst@8.0.1
dyninst@8.0.1
    ^libdwarf
        ^libelf

dyninst@8.0.1%gcc@4.7.3<span class="o">=</span>linux-ppc64
    ^libdwarf@20130729%gcc@4.7.3<span class="o">=</span>linux-ppc64
        ^libelf@0.8.13%gcc@4.7.3<span class="o">=</span>linux-ppc64
</pre></div>
</div>
<p>This is useful when you want to know exactly what Spack will do when
you ask for a particular spec.</p>
</div>
<div class="section" id="concretization-policies">
<h3><code class="docutils literal"><span class="pre">Concretization</span> <span class="pre">Policies</span></code><a class="headerlink" href="#concretization-policies" title="Permalink to this headline"></a></h3>
<p>A user may have certain preferences for how packages should
be concretized on their system.  For example, one user may prefer packages
built with OpenMPI and the Intel compiler.  Another user may prefer
packages be built with MVAPICH and GCC.</p>
<p>Spack can be configured to prefer certain compilers, package
versions, depends_on, and variants during concretization.
The preferred configuration can be controlled via the
<code class="docutils literal"><span class="pre">~/.spack/packages.yaml</span></code> file for user configuations, or the
<code class="docutils literal"><span class="pre">etc/spack/packages.yaml</span></code> site configuration.</p>
<p>Here&#8217;s an example packages.yaml file that sets preferred packages:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>packages:
  dyninst:
    compiler: <span class="o">[</span>gcc@4.9<span class="o">]</span>
    variants: +debug
  gperftools:
    version: <span class="o">[</span>2.2, 2.4, 2.3<span class="o">]</span>
  all:
    compiler: <span class="o">[</span>gcc@4.4.7, gcc@4.6:, intel, clang, pgi<span class="o">]</span>
    providers:
      mpi: <span class="o">[</span>mvapich, mpich, openmpi<span class="o">]</span>
</pre></div>
</div>
<p>At a high level, this example is specifying how packages should be
concretized.  The dyninst package should prefer using gcc 4.9 and
be built with debug options.  The gperftools package should prefer version
2.2 over 2.4.  Every package on the system should prefer mvapich for
its MPI and gcc 4.4.7 (except for Dyninst, which overrides this by preferring gcc 4.9).
These options are used to fill in implicit defaults.  Any of them can be overwritten
on the command line if explicitly requested.</p>
<p>Each packages.yaml file begins with the string <code class="docutils literal"><span class="pre">packages:</span></code> and
package names are specified on the next level. The special string <code class="docutils literal"><span class="pre">all</span></code>
applies settings to each package. Underneath each package name is
one or more components: <code class="docutils literal"><span class="pre">compiler</span></code>, <code class="docutils literal"><span class="pre">variants</span></code>, <code class="docutils literal"><span class="pre">version</span></code>,
or <code class="docutils literal"><span class="pre">providers</span></code>.  Each component has an ordered list of spec
<code class="docutils literal"><span class="pre">constraints</span></code>, with earlier entries in the list being preferred over
later entries.</p>
<p>Sometimes a package installation may have constraints that forbid
the first concretization rule, in which case Spack will use the first
legal concretization rule.  Going back to the example, if a user
requests gperftools 2.3 or later, then Spack will install version 2.4
as the 2.4 version of gperftools is preferred over 2.3.</p>
<p>An explicit concretization rule in the preferred section will always
take preference over unlisted concretizations.  In the above example,
xlc isn&#8217;t listed in the compiler list.  Every listed compiler from
gcc to pgi will thus be preferred over the xlc compiler.</p>
<p>The syntax for the <code class="docutils literal"><span class="pre">provider</span></code> section differs slightly from other
concretization rules.  A provider lists a value that packages may
<code class="docutils literal"><span class="pre">depend_on</span></code> (e.g, mpi) and a list of rules for fulfilling that
dependency.</p>
</div>
</div>
<div class="section" id="implementing-the-install-method">
<span id="install-method"></span><h2>Implementing the <code class="docutils literal"><span class="pre">install</span></code> method<a class="headerlink" href="#implementing-the-install-method" title="Permalink to this headline"></a></h2>
<p>The last element of a package is its <code class="docutils literal"><span class="pre">install()</span></code> method.  This is
where the real work of installation happens, and it&#8217;s the main part of
the package you&#8217;ll need to customize for each piece of software.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
    <span class="n">provides</span><span class="p">(</span><span class="s1">&#39;elf&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                  <span class="s2">&quot;--enable-shared&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;--disable-dependency-tracking&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;--disable-debug&quot;</span><span class="p">)</span>
        <span class="n">make</span><span class="p">()</span>

        <span class="c1"># The mkdir commands in libelf&#39;s install can fail in parallel</span>
        <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal"><span class="pre">install</span></code> takes a <code class="docutils literal"><span class="pre">spec</span></code>: a description of how the package should
be built, and a <code class="docutils literal"><span class="pre">prefix</span></code>: the path to the directory where the
software should be installed.</p>
<p>Spack provides wrapper functions for <code class="docutils literal"><span class="pre">configure</span></code> and <code class="docutils literal"><span class="pre">make</span></code> so
that you can call them in a similar way to how you&#8217;d call a shell
command.  In reality, these are Python functions.  Spack provides
these functions to make writing packages more natural. See the section
on <a class="reference internal" href="#shell-wrappers"><span>shell wrappers</span></a>.</p>
<p>Now that the metadata is out of the way, we can move on to the
<code class="docutils literal"><span class="pre">install()</span></code> method.  When a user runs <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code>, Spack
fetches an archive for the correct version of the software, expands
the archive, and sets the current working directory to the root
directory of the expanded archive.  It then instantiates a package
object and calls the <code class="docutils literal"><span class="pre">install()</span></code> method.</p>
<p>The <code class="docutils literal"><span class="pre">install()</span></code> signature looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The parameters are as follows:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">self</span></code></dt>
<dd>For those not used to Python instance methods, this is the
package itself.  In this case it&#8217;s an instance of <code class="docutils literal"><span class="pre">Foo</span></code>, which
extends <code class="docutils literal"><span class="pre">Package</span></code>.  For API docs on Package objects, see
<a class="reference internal" href="spack.html#spack.package.Package" title="spack.package.Package"><code class="xref py py-class docutils literal"><span class="pre">Package</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">spec</span></code></dt>
<dd>This is the concrete spec object created by Spack from an
abstract spec supplied by the user.  It describes what should be
installed.  It will be of type <a class="reference internal" href="spack.html#spack.spec.Spec" title="spack.spec.Spec"><code class="xref py py-class docutils literal"><span class="pre">Spec</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">prefix</span></code></dt>
<dd>This is the path that your install method should copy build
targets into.  It acts like a string, but it&#8217;s actually its own
special type, <a class="reference internal" href="spack.util.html#spack.util.prefix.Prefix" title="spack.util.prefix.Prefix"><code class="xref py py-class docutils literal"><span class="pre">Prefix</span></code></a>.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">spec</span></code> and <code class="docutils literal"><span class="pre">prefix</span></code> are passed to <code class="docutils literal"><span class="pre">install</span></code> for convenience.
<code class="docutils literal"><span class="pre">spec</span></code> is also available as an attribute on the package
(<code class="docutils literal"><span class="pre">self.spec</span></code>), and <code class="docutils literal"><span class="pre">prefix</span></code> is actually an attribute of <code class="docutils literal"><span class="pre">spec</span></code>
(<code class="docutils literal"><span class="pre">spec.prefix</span></code>).</p>
<p>As mentioned in <a class="reference internal" href="#install-environment"><span>The install environment</span></a>, you will usually not need
to refer to dependencies explicitly in your package file, as the
compiler wrappers take care of most of the heavy lifting here.  There
will be times, though, when you need to refer to the install locations
of dependencies, or when you need to do something different depending
on the version, compiler, dependencies, etc. that your package is
built with.  These parameters give you access to this type of
information.</p>
</div>
<div class="section" id="the-install-environment">
<span id="install-environment"></span><h2>The install environment<a class="headerlink" href="#the-install-environment" title="Permalink to this headline"></a></h2>
<p>In general, you should not have to do much differently in your install
method than you would when installing a package on the command line.
In fact, you may need to do <em>less</em> than you would on the command line.</p>
<p>Spack tries to set environment variables and modify compiler calls so
that it <em>appears</em> to the build system that you&#8217;re building with a
standard system install of everything.  Obviously that&#8217;s not going to
cover <em>all</em> build systems, but it should make it easy to port packages
to Spack if they use a standard build system.  Usually with autotools
or cmake, building and installing is easy.  With builds that use
custom Makefiles, you may need to add logic to modify the makefiles.</p>
<p>The remainder of the section covers the way Spack&#8217;s build environment
works.</p>
<div class="section" id="environment-variables">
<h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline"></a></h3>
<p>Spack sets a number of standard environment variables that serve two
purposes:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Make build systems use Spack&#8217;s compiler wrappers for their builds.</li>
<li>Allow build systems to find dependencies more easily</li>
</ol>
</div></blockquote>
<p>The Compiler environment variables that Spack sets are:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CC</span></code></td>
<td>C compiler</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CXX</span></code></td>
<td>C++ compiler</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">F77</span></code></td>
<td>Fortran 77 compiler</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">FC</span></code></td>
<td>Fortran 90 and above compiler</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>All of these are standard variables respected by most build systems.
If your project uses <code class="docutils literal"><span class="pre">autotools</span></code> or <code class="docutils literal"><span class="pre">CMake</span></code>, then it should pick
them up automatically when you run <code class="docutils literal"><span class="pre">configure</span></code> or <code class="docutils literal"><span class="pre">cmake</span></code> in the
<code class="docutils literal"><span class="pre">install()</span></code> function.  Many traditional builds using GNU Make and
BSD make also respect these variables, so they may work with these
systems.</p>
<p>If your build system does <em>not</em> automatically pick these variables up
from the environment, then you can simply pass them on the command
line or use a patch as part of your build process to get the correct
compilers into the project&#8217;s build system.  There are also some file
editing commands you can use &#8211; these are described later in the
<a class="reference internal" href="#file-manipulation">section on file manipulation</a>.</p>
<p>In addition to the compiler variables, these variables are set before
entering <code class="docutils literal"><span class="pre">install()</span></code> so that packages can locate dependencies
easily:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PATH</span></code></td>
<td>Set to point to <code class="docutils literal"><span class="pre">/bin</span></code> directories of dependencies</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CMAKE_PREFIX_PATH</span></code></td>
<td>Path to dependency prefixes for CMake</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PKG_CONFIG_PATH</span></code></td>
<td>Path to any pkgconfig directories for dependencies</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PYTHONPATH</span></code></td>
<td>Path to site-packages dir of any python dependencies</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">PATH</span></code> is set up to point to dependencies <code class="docutils literal"><span class="pre">/bin</span></code> directories so
that you can use tools installed by dependency packages at build time.
For example, <code class="docutils literal"><span class="pre">$MPICH_ROOT/bin/mpicc</span></code> is frequently used by dependencies of
<code class="docutils literal"><span class="pre">mpich</span></code>.</p>
<p><code class="docutils literal"><span class="pre">CMAKE_PREFIX_PATH</span></code> contains a colon-separated list of prefixes
where <code class="docutils literal"><span class="pre">cmake</span></code> will search for dependency libraries and headers.
This causes all standard CMake find commands to look in the paths of
your dependencies, so you <em>do not</em> have to manually specify arguments
like <code class="docutils literal"><span class="pre">-D</span> <span class="pre">DEPENDENCY_DIR=/path/to/dependency</span></code> to <code class="docutils literal"><span class="pre">cmake</span></code>.  More on
this is <a class="reference external" href="http://www.cmake.org/cmake/help/v3.0/variable/CMAKE_PREFIX_PATH.html">in the CMake documentation</a>.</p>
<p><code class="docutils literal"><span class="pre">PKG_CONFIG_PATH</span></code> is for packages that attempt to discover
dependencies using the GNU <code class="docutils literal"><span class="pre">pkg-config</span></code> tool.  It is similar to
<code class="docutils literal"><span class="pre">CMAKE_PREFIX_PATH</span></code> in that it allows a build to automatically
discover its dependencies.</p>
<p>If you want to see the environment that a package will build with, or
if you want to run commands in that environment to test them out, you
can use the :ref:<code class="docutils literal"><span class="pre">`spack</span> <span class="pre">env</span></code> &lt;spack-env&gt;` command, documented
below.</p>
</div>
<div class="section" id="compiler-interceptors">
<span id="compiler-wrappers"></span><h3>Compiler interceptors<a class="headerlink" href="#compiler-interceptors" title="Permalink to this headline"></a></h3>
<p>As mentioned, <code class="docutils literal"><span class="pre">CC</span></code>, <code class="docutils literal"><span class="pre">CXX</span></code>, <code class="docutils literal"><span class="pre">F77</span></code>, and <code class="docutils literal"><span class="pre">FC</span></code> are set to point to
Spack&#8217;s compiler wrappers.  These are simply called <code class="docutils literal"><span class="pre">cc</span></code>, <code class="docutils literal"><span class="pre">c++</span></code>,
<code class="docutils literal"><span class="pre">f77</span></code>, and <code class="docutils literal"><span class="pre">f90</span></code>, and they live in <code class="docutils literal"><span class="pre">$SPACK_ROOT/lib/spack/env</span></code>.</p>
<p><code class="docutils literal"><span class="pre">$SPACK_ROOT/lib/spack/env</span></code> is added first in the <code class="docutils literal"><span class="pre">PATH</span></code>
environment variable when <code class="docutils literal"><span class="pre">install()</span></code> runs so that system compilers
are not picked up instead.</p>
<p>All of these compiler wrappers point to a single compiler wrapper
script that figures out which <em>real</em> compiler it should be building
with.  This comes either from spec <a class="reference external" href="abstract-and-concrete">concretization</a> or from a user explicitly asking for a
particular compiler using, e.g., <code class="docutils literal"><span class="pre">%intel</span></code> on the command line.</p>
<p>In addition to invoking the right compiler, the compiler wrappers add
flags to the compile line so that dependencies can be easily found.
These flags are added for each dependency, if they exist:</p>
<dl class="docutils">
<dt>Compile-time library search paths</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">-L$dep_prefix/lib</span></code></li>
<li><code class="docutils literal"><span class="pre">-L$dep_prefix/lib64</span></code></li>
</ul>
</dd>
<dt>Runtime library search paths (RPATHs)</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">$rpath_flag$dep_prefix/lib</span></code></li>
<li><code class="docutils literal"><span class="pre">$rpath_flag$dep_prefix/lib64</span></code></li>
</ul>
</dd>
<dt>Include search paths</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">-I$dep_prefix/include</span></code></li>
</ul>
</dd>
</dl>
<p>An example of this would be the <code class="docutils literal"><span class="pre">libdwarf</span></code> build, which has one
dependency: <code class="docutils literal"><span class="pre">libelf</span></code>.  Every call to <code class="docutils literal"><span class="pre">cc</span></code> in the <code class="docutils literal"><span class="pre">libdwarf</span></code>
build will have <code class="docutils literal"><span class="pre">-I$LIBELF_PREFIX/include</span></code>,
<code class="docutils literal"><span class="pre">-L$LIBELF_PREFIX/lib</span></code>, and <code class="docutils literal"><span class="pre">$rpath_flag$LIBELF_PREFIX/lib</span></code>
inserted on the command line.  This is done transparently to the
project&#8217;s build system, which will just think it&#8217;s using a system
where <code class="docutils literal"><span class="pre">libelf</span></code> is readily available.  Because of this, you <strong>do
not</strong> have to insert extra <code class="docutils literal"><span class="pre">-I</span></code>, <code class="docutils literal"><span class="pre">-L</span></code>, etc. on the command line.</p>
<p>Another useful consequence of this is that you often do <em>not</em> have to
add extra parameters on the <code class="docutils literal"><span class="pre">configure</span></code> line to get autotools to
find dependencies.  The <code class="docutils literal"><span class="pre">libdwarf</span></code> install method just calls
configure like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
<p>Because of the <code class="docutils literal"><span class="pre">-L</span></code> and <code class="docutils literal"><span class="pre">-I</span></code> arguments, configure will
successfully find <code class="docutils literal"><span class="pre">libdwarf.h</span></code> and <code class="docutils literal"><span class="pre">libdwarf.so</span></code>, without the
packager having to provide <code class="docutils literal"><span class="pre">--with-libdwarf=/path/to/libdwarf</span></code> on
the command line.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For most compilers, <code class="docutils literal"><span class="pre">$rpath_flag</span></code> is <code class="docutils literal"><span class="pre">-Wl,-rpath,</span></code>. However, NAG
passes its flags to GCC instead of passing them directly to the linker.
Therefore, its <code class="docutils literal"><span class="pre">$rpath_flag</span></code> is doubly wrapped: <code class="docutils literal"><span class="pre">-Wl,-Wl,,-rpath,</span></code>.
<code class="docutils literal"><span class="pre">$rpath_flag</span></code> can be overriden on a compiler specific basis in
<code class="docutils literal"><span class="pre">lib/spack/spack/compilers/$compiler.py</span></code>.</p>
</div>
</div>
<div class="section" id="compiler-flags">
<h3>Compiler flags<a class="headerlink" href="#compiler-flags" title="Permalink to this headline"></a></h3>
<p>In rare circumstances such as compiling and running small unit tests, a package
developer may need to know what are the appropriate compiler flags to enable
features like <code class="docutils literal"><span class="pre">OpenMP</span></code>, <code class="docutils literal"><span class="pre">c++11</span></code>, <code class="docutils literal"><span class="pre">c++14</span></code> and alike. To that end the
compiler classes in <code class="docutils literal"><span class="pre">spack</span></code> implement the following _properties_ :
<code class="docutils literal"><span class="pre">openmp_flag</span></code>, <code class="docutils literal"><span class="pre">cxx11_flag</span></code>, <code class="docutils literal"><span class="pre">cxx14_flag</span></code>, which can be accessed in a
package by <code class="docutils literal"><span class="pre">self.compiler.cxx11_flag</span></code> and alike. Note that the implementation
is such that if a given compiler version does not support this feature, an
error will be produced. Therefore package developers can also use these properties
to assert that a compiler supports the requested feature. This is handy when a
package supports additional variants like</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">variant</span><span class="p">(</span><span class="s1">&#39;openmp&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Enable OpenMP support.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="message-parsing-interface-mpi">
<h3>Message Parsing Interface (MPI)<a class="headerlink" href="#message-parsing-interface-mpi" title="Permalink to this headline"></a></h3>
<p>It is common for high performance computing software/packages to use <code class="docutils literal"><span class="pre">MPI</span></code>.
As a result of conretization, a given package can be built using different
implementations of MPI such as <code class="docutils literal"><span class="pre">Openmpi</span></code>, <code class="docutils literal"><span class="pre">MPICH</span></code> or <code class="docutils literal"><span class="pre">IntelMPI</span></code>.
In some scenarios to configure a package one have to provide it with appropriate MPI
compiler wrappers such as <code class="docutils literal"><span class="pre">mpicc</span></code>, <code class="docutils literal"><span class="pre">mpic++</span></code>.
However different implementations of <code class="docutils literal"><span class="pre">MPI</span></code> may have different names for those
wrappers.  In order to make package&#8217;s <code class="docutils literal"><span class="pre">install()</span></code> method indifferent to the
choice <code class="docutils literal"><span class="pre">MPI</span></code> implementation, each package which implements <code class="docutils literal"><span class="pre">MPI</span></code> sets up
<code class="docutils literal"><span class="pre">self.spec.mpicc</span></code>, <code class="docutils literal"><span class="pre">self.spec.mpicxx</span></code>, <code class="docutils literal"><span class="pre">self.spec.mpifc</span></code> and <code class="docutils literal"><span class="pre">self.spec.mpif77</span></code>
to point to <code class="docutils literal"><span class="pre">C</span></code>, <code class="docutils literal"><span class="pre">C++</span></code>, <code class="docutils literal"><span class="pre">Fortran</span> <span class="pre">90</span></code> and <code class="docutils literal"><span class="pre">Fortran</span> <span class="pre">77</span></code> <code class="docutils literal"><span class="pre">MPI</span></code> wrappers.
Package developers are advised to use these variables, for example <code class="docutils literal"><span class="pre">self.spec['mpi'].mpicc</span></code>
instead of hard-coding <code class="docutils literal"><span class="pre">join_path(self.spec['mpi'].prefix.bin,</span> <span class="pre">'mpicc')</span></code> for
the reasons outlined above.</p>
</div>
<div class="section" id="forking-install">
<h3>Forking <code class="docutils literal"><span class="pre">install()</span></code><a class="headerlink" href="#forking-install" title="Permalink to this headline"></a></h3>
<p>To give packagers free reign over their install environment, Spack
forks a new process each time it invokes a package&#8217;s <code class="docutils literal"><span class="pre">install()</span></code>
method.  This allows packages to have their own completely sandboxed
build environment, without impacting other jobs that the main Spack
process runs.  Packages are free to change the environment or to
modify Spack internals, because each <code class="docutils literal"><span class="pre">install()</span></code> call has its own
dedicated process.</p>
</div>
</div>
<div class="section" id="failing-the-build">
<span id="prefix-objects"></span><h2>Failing the build<a class="headerlink" href="#failing-the-build" title="Permalink to this headline"></a></h2>
<p>Sometimes you don&#8217;t want a package to successfully install unless some
condition is true.  You can explicitly cause the build to fail from
<code class="docutils literal"><span class="pre">install()</span></code> by raising an <code class="docutils literal"><span class="pre">InstallError</span></code>, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">InstallError</span><span class="p">(</span><span class="s1">&#39;This package does not build on Mac OS X!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h2>Prefix objects<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h2>
<p>Spack passes the <code class="docutils literal"><span class="pre">prefix</span></code> parameter to the install method so that
you can pass it to <code class="docutils literal"><span class="pre">configure</span></code>, <code class="docutils literal"><span class="pre">cmake</span></code>, or some other installer,
e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;--prefix=&#39;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
<p>For the most part, prefix objects behave exactly like strings.  For
packages that do not have their own install target, or for those that
implement it poorly (like <code class="docutils literal"><span class="pre">libdwarf</span></code>), you may need to manually copy
things into particular directories under the prefix.  For this, you
can refer to standard subdirectories without having to construct paths
yourself, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">mkdirp</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">)</span>
    <span class="n">install</span><span class="p">(</span><span class="s1">&#39;foo-tool&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">)</span>

    <span class="n">mkdirp</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">include</span><span class="p">)</span>
    <span class="n">install</span><span class="p">(</span><span class="s1">&#39;foo.h&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">.</span><span class="n">include</span><span class="p">)</span>

    <span class="n">mkdirp</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>
    <span class="n">install</span><span class="p">(</span><span class="s1">&#39;libfoo.a&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>
</pre></div>
</div>
<p>Most of the standard UNIX directory names are attributes on the
<code class="docutils literal"><span class="pre">prefix</span></code> object.  Here is a full list:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prefix Attribute</th>
<th class="head">Location</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.bin</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/bin</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.sbin</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/sbin</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.etc</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/etc</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.include</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/include</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.lib</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/lib</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.lib64</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/lib64</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.libexec</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/libexec</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.share</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/share</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.doc</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/doc</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.info</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/info</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.man</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/man</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.man[1-8]</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/man/man[1-8]</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">prefix.share_man</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/share/man</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prefix.share_man[1-8]</span></code></td>
<td><code class="docutils literal"><span class="pre">$prefix/share/man[1-8]</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="spec-objects">
<span id="id13"></span><h2>Spec objects<a class="headerlink" href="#spec-objects" title="Permalink to this headline"></a></h2>
<p>When <code class="docutils literal"><span class="pre">install</span></code> is called, most parts of the build process are set up
for you.  The correct version&#8217;s tarball has been downloaded and
expanded.  Environment variables like <code class="docutils literal"><span class="pre">CC</span></code> and <code class="docutils literal"><span class="pre">CXX</span></code> are set to
point to the correct compiler and version.  An install prefix has
already been selected and passed in as <code class="docutils literal"><span class="pre">prefix</span></code>.  In most cases this
is all you need to get <code class="docutils literal"><span class="pre">configure</span></code>, <code class="docutils literal"><span class="pre">cmake</span></code>, or another install
working correctly.</p>
<p>There will be times when you need to know more about the build
configuration.  For example, some software requires that you pass
special parameters to <code class="docutils literal"><span class="pre">configure</span></code>, like
<code class="docutils literal"><span class="pre">--with-libelf=/path/to/libelf</span></code> or <code class="docutils literal"><span class="pre">--with-mpich</span></code>.  You might also
need to supply special compiler flags depending on the compiler.  All
of this information is available in the spec.</p>
<div class="section" id="testing-spec-constraints">
<h3>Testing spec constraints<a class="headerlink" href="#testing-spec-constraints" title="Permalink to this headline"></a></h3>
<p>You can test whether your spec is configured a certain way by using
the <code class="docutils literal"><span class="pre">satisfies</span></code> method.  For example, if you want to check whether
the package&#8217;s version is in a particular range, you can use specs to
do that, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">&#39;@1.2:1.4&#39;</span><span class="p">):</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CXXFLAGS=&#39;-DWITH_FEATURE&#39;&quot;</span><span class="p">)</span>
<span class="n">configure</span><span class="p">(</span><span class="s1">&#39;--prefix=&#39;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">configure_args</span><span class="p">)</span>
</pre></div>
</div>
<p>This works for compilers, too:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">cc&#39;</span><span class="p">):</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CXXFLAGS=&quot;-g3 -O3&quot;&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">ntel&#39;</span><span class="p">):</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CXXFLAGS=&quot;-xSSE2 -fast&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or for combinations of spec constraints:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">&#39;@1.2</span><span class="si">%i</span><span class="s1">ntel&#39;</span><span class="p">):</span>
    <span class="n">tty</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Version 1.2 breaks when using Intel compiler!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also do similar satisfaction tests for dependencies:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">satisfies</span><span class="p">(</span><span class="s1">&#39;^dyninst@8.0&#39;</span><span class="p">):</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CXXFLAGS=-DSPECIAL_DYNINST_FEATURE&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This could allow you to easily work around a bug in a particular
dependency version.</p>
<p>You can use <code class="docutils literal"><span class="pre">satisfies()</span></code> to test for particular dependencies,
e.g. <code class="docutils literal"><span class="pre">foo.satisfies('^openmpi&#64;1.2')</span></code> or <code class="docutils literal"><span class="pre">foo.satisfies('^mpich')</span></code>,
or you can use Python&#8217;s built-in <code class="docutils literal"><span class="pre">in</span></code> operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;libelf&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
    <span class="k">print</span> <span class="s2">&quot;this package depends on libelf&quot;</span>
</pre></div>
</div>
<p>This is useful for virtual dependencies, as you can easily see what
implementation was selected for this build:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;openmpi&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--with-openmpi&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="s1">&#39;mpich&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--with-mpich&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="s1">&#39;mvapich&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
    <span class="n">configure_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--with-mvapich&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It&#8217;s also a bit more concise than satisfies.  The difference between
the two functions is that <code class="docutils literal"><span class="pre">satisfies()</span></code> tests whether spec
constraints overlap at all, while <code class="docutils literal"><span class="pre">in</span></code> tests whether a spec or any
of its dependencies satisfy the provided spec.</p>
</div>
<div class="section" id="accessing-dependencies">
<h3>Accessing Dependencies<a class="headerlink" href="#accessing-dependencies" title="Permalink to this headline"></a></h3>
<p>You may need to get at some file or binary that&#8217;s in the prefix of one
of your dependencies.  You can do that by sub-scripting the spec:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_mpi</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;mpich&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The value in the brackets needs to be some package name, and spec
needs to depend on that package, or the operation will fail.  For
example, the above code will fail if the <code class="docutils literal"><span class="pre">spec</span></code> doesn&#8217;t depend on
<code class="docutils literal"><span class="pre">mpich</span></code>.  The value returned and assigned to <code class="docutils literal"><span class="pre">my_mpi</span></code>, is itself
just another <code class="docutils literal"><span class="pre">Spec</span></code> object, so you can do all the same things you
would do with the package&#8217;s own spec:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mpicc</span> <span class="o">=</span> <span class="n">new_path</span><span class="p">(</span><span class="n">my_mpi</span><span class="o">.</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="s1">&#39;mpicc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="multimethods-and-when">
<span id="multimethods"></span><h3>Multimethods and <code class="docutils literal"><span class="pre">&#64;when</span></code><a class="headerlink" href="#multimethods-and-when" title="Permalink to this headline"></a></h3>
<p>Spack allows you to make multiple versions of instance functions in
packages, based on whether the package&#8217;s spec satisfies particular
criteria.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;when</span></code> annotation lets packages declare multiple versions of
methods like install() that depend on the package&#8217;s spec.  For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomePackage</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># Do default install</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;=chaos_5_x86_64_ib&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># This will be executed instead of the default install if</span>
        <span class="c1"># the package&#39;s sys_type() is chaos_5_x86_64_ib.</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;=bgqos_0&quot;)</span>
    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># This will be executed if the package&#39;s sys_type is bgqos_0</span>
</pre></div>
</div>
<p>In the above code there are three versions of install(), two of which
are specialized for particular platforms.  The version that is called
depends on the architecture of the package spec.</p>
<p>Note that this works for methods other than install, as well.  So,
if you only have part of the install that is platform specific, you
could do something more like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomePackage</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
   <span class="o">...</span>
    <span class="c1"># virtual dependence on MPI.</span>
    <span class="c1"># could resolve to mpich, mpich2, OpenMPI</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="s1">&#39;mpi&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># do nothing in the default case</span>
        <span class="k">pass</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;^openmpi&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># do something special when this is built with OpenMPI for</span>
        <span class="c1"># its MPI implementations.</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># Do common install stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="c1"># Do more common install stuff</span>
</pre></div>
</div>
<p>You can write multiple <code class="docutils literal"><span class="pre">&#64;when</span></code> specs that satisfy the package&#8217;s spec,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomePackage</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">depends_on</span><span class="p">(</span><span class="s1">&#39;mpi&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># the default, called when no @when specs match</span>
        <span class="k">pass</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;^mpi@3:&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this will be called when mpi is version 3 or higher</span>
        <span class="k">pass</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;^mpi@2:&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this will be called when mpi is version 2 or higher</span>
        <span class="k">pass</span>

    <span class="nd">@when</span><span class="p">(</span><span class="s1">&#39;^mpi@1:&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this will be called when mpi is version 1 or higher</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>In situations like this, the first matching spec, in declaration order
will be called.  As before, if no <code class="docutils literal"><span class="pre">&#64;when</span></code> spec matches, the default
method (the one without the <code class="docutils literal"><span class="pre">&#64;when</span></code> decorator) will be called.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The default version of decorated methods must <strong>always</strong> come
first.  Otherwise it will override all of the platform-specific
versions.  There&#8217;s not much we can do to get around this because of
the way decorators work.</p>
</div>
</div>
</div>
<div class="section" id="shell-command-functions">
<span id="shell-wrappers"></span><h2>Shell command functions<a class="headerlink" href="#shell-command-functions" title="Permalink to this headline"></a></h2>
<p>Recall the install method from <code class="docutils literal"><span class="pre">libelf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
              <span class="s2">&quot;--enable-shared&quot;</span><span class="p">,</span>
              <span class="s2">&quot;--disable-dependency-tracking&quot;</span><span class="p">,</span>
              <span class="s2">&quot;--disable-debug&quot;</span><span class="p">)</span>
    <span class="n">make</span><span class="p">()</span>

    <span class="c1"># The mkdir commands in libelf&#39;s install can fail in parallel</span>
    <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Normally in Python, you&#8217;d have to write something like this in order
to execute shell commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s1">&#39;configure&#39;</span><span class="p">,</span> <span class="s1">&#39;--prefix=&#39;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
<p>We&#8217;ve tried to make this a bit easier by providing callable wrapper
objects for some shell commands.  By default, <code class="docutils literal"><span class="pre">configure</span></code>,
<code class="docutils literal"><span class="pre">cmake</span></code>, and <code class="docutils literal"><span class="pre">make</span></code> wrappers are are provided, so you can call
them more naturally in your package files.</p>
<p>If you need other commands, you can use <code class="docutils literal"><span class="pre">which</span></code> to get them:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;sed&#39;</span><span class="p">)</span>
<span class="n">sed</span><span class="p">(</span><span class="s1">&#39;s/foo/bar/&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">which</span></code> function will search the <code class="docutils literal"><span class="pre">PATH</span></code> for the application.</p>
<p>Callable wrappers also allow spack to provide some special features.
For example, in Spack, <code class="docutils literal"><span class="pre">make</span></code> is parallel by default, and Spack
figures out the number of cores on your machine and passes an
appropriate value for <code class="docutils literal"><span class="pre">-j&lt;numjobs&gt;</span></code> when it calls <code class="docutils literal"><span class="pre">make</span></code> (see the
<code class="docutils literal"><span class="pre">parallel</span></code> package attribute under <span class="xref std std-ref">metadata</span>).  In
a package file, you can supply a keyword argument, <code class="docutils literal"><span class="pre">parallel=False</span></code>,
to the <code class="docutils literal"><span class="pre">make</span></code> wrapper to disable parallel make.  In the <code class="docutils literal"><span class="pre">libelf</span></code>
package, this allows us to avoid race conditions in the library&#8217;s
build system.</p>
</div>
<div class="section" id="sanity-checking-an-intallation">
<span id="sanity-checks"></span><h2>Sanity checking an intallation<a class="headerlink" href="#sanity-checking-an-intallation" title="Permalink to this headline"></a></h2>
<p>By default, Spack assumes that a build has failed if nothing is
written to the install prefix, and that it has succeeded if anything
(a file, a directory, etc.)  is written to the install prefix after
<code class="docutils literal"><span class="pre">install()</span></code> completes.</p>
<p>Consider a simple autotools build like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="n">make</span><span class="p">()</span>
    <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are using using standard autotools or CMake, <code class="docutils literal"><span class="pre">configure</span></code> and
<code class="docutils literal"><span class="pre">make</span></code> will not write anything to the install prefix.  Only <code class="docutils literal"><span class="pre">make</span>
<span class="pre">install</span></code> writes the files, and only once the build is already
complete.  Not all builds are like this.  Many builds of scientific
software modify the install prefix <em>before</em> <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code>. Builds
like this can falsely report that they were successfully installed if
an error occurs before the install is complete but after files have
been written to the <code class="docutils literal"><span class="pre">prefix</span></code>.</p>
<div class="section" id="sanity-check-is-file-and-sanity-check-is-dir">
<h3><code class="docutils literal"><span class="pre">sanity_check_is_file</span></code> and <code class="docutils literal"><span class="pre">sanity_check_is_dir</span></code><a class="headerlink" href="#sanity-check-is-file-and-sanity-check-is-dir" title="Permalink to this headline"></a></h3>
<p>You can optionally specify <em>sanity checks</em> to deal with this problem.
Add properties like this to your package:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPackage</span><span class="p">(</span><span class="n">Package</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="n">sanity_check_is_file</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;include/libelf.h&#39;</span><span class="p">]</span>
    <span class="n">sanity_check_is_dir</span>  <span class="o">=</span> <span class="p">[</span><span class="n">lib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="n">make</span><span class="p">()</span>
        <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, after <code class="docutils literal"><span class="pre">install()</span></code> runs, Spack will check whether
<code class="docutils literal"><span class="pre">$prefix/include/libelf.h</span></code> exists and is a file, and whether
<code class="docutils literal"><span class="pre">$prefix/lib</span></code> exists and is a directory.  If the checks fail, then
the build will fail and the install prefix will be removed.  If they
succeed, Spack considers the build succeeful and keeps the prefix in
place.</p>
</div>
</div>
<div class="section" id="file-manipulation-functions">
<span id="file-manipulation"></span><h2>File manipulation functions<a class="headerlink" href="#file-manipulation-functions" title="Permalink to this headline"></a></h2>
<p>Many builds are not perfect. If a build lacks an install target, or if
it does not use systems like CMake or autotools, which have standard
ways of setting compilers and options, you may need to edit files or
install some files yourself to get them working with Spack.</p>
<p>You can do this with standard Python code, and Python has rich
libraries with functions for file manipulation and filtering.  Spack
also provides a number of convenience functions of its own to make
your life even easier.  These functions are described in this section.</p>
<p>All of the functions in this section can be included by simply
running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spack</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>This is already part of the boilerplate for packages created with
<code class="docutils literal"><span class="pre">spack</span> <span class="pre">create</span></code> or <code class="docutils literal"><span class="pre">spack</span> <span class="pre">edit</span></code>.</p>
<div class="section" id="filtering-functions">
<h3>Filtering functions<a class="headerlink" href="#filtering-functions" title="Permalink to this headline"></a></h3>
<dl class="docutils">
<dt><a class="reference internal" href="spack.html#spack.filter_file" title="spack.filter_file"><code class="xref py py-func docutils literal"><span class="pre">filter_file(regex,</span> <span class="pre">repl,</span> <span class="pre">*filenames,</span> <span class="pre">**kwargs)</span></code></a></dt>
<dd><p class="first">Works like <code class="docutils literal"><span class="pre">sed</span></code> but with Python regular expression syntax.  Takes
a regular expression, a replacement, and a set of files.  <code class="docutils literal"><span class="pre">repl</span></code>
can be a raw string or a callable function.  If it is a raw string,
it can contain <code class="docutils literal"><span class="pre">\1</span></code>, <code class="docutils literal"><span class="pre">\2</span></code>, etc. to refer to capture groups in
the regular expression.  If it is a callable, it is passed the
Python <code class="docutils literal"><span class="pre">MatchObject</span></code> and should return a suitable replacement
string for the particular match.</p>
<p>Examples:</p>
<ol class="last arabic">
<li><p class="first">Filtering a Makefile to force it to use Spack&#8217;s compiler wrappers:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filter_file</span><span class="p">(</span><span class="s1">r&#39;^CC\s*=.*&#39;</span><span class="p">,</span>  <span class="n">spack_cc</span><span class="p">,</span>  <span class="s1">&#39;Makefile&#39;</span><span class="p">)</span>
<span class="n">filter_file</span><span class="p">(</span><span class="s1">r&#39;^CXX\s*=.*&#39;</span><span class="p">,</span> <span class="n">spack_cxx</span><span class="p">,</span> <span class="s1">&#39;Makefile&#39;</span><span class="p">)</span>
<span class="n">filter_file</span><span class="p">(</span><span class="s1">r&#39;^F77\s*=.*&#39;</span><span class="p">,</span> <span class="n">spack_f77</span><span class="p">,</span> <span class="s1">&#39;Makefile&#39;</span><span class="p">)</span>
<span class="n">filter_file</span><span class="p">(</span><span class="s1">r&#39;^FC\s*=.*&#39;</span><span class="p">,</span>  <span class="n">spack_fc</span><span class="p">,</span>  <span class="s1">&#39;Makefile&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Replacing <code class="docutils literal"><span class="pre">#!/usr/bin/perl</span></code> with <code class="docutils literal"><span class="pre">#!/usr/bin/env</span> <span class="pre">perl</span></code> in <code class="docutils literal"><span class="pre">bib2xhtml</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filter_file</span><span class="p">(</span><span class="s1">r&#39;#!/usr/bin/perl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;#!/usr/bin/env perl&#39;</span><span class="p">,</span> <span class="n">join_path</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="s1">&#39;bib2xhtml&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Switching the compilers used by <code class="docutils literal"><span class="pre">mpich</span></code>&#8216;s MPI wrapper scripts from
<code class="docutils literal"><span class="pre">cc</span></code>, etc. to the compilers used by the Spack build:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filter_file</span><span class="p">(</span><span class="s1">&#39;CC=&quot;cc&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;CC=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">cc</span><span class="p">,</span>
            <span class="n">join_path</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="s1">&#39;mpicc&#39;</span><span class="p">))</span>

<span class="n">filter_file</span><span class="p">(</span><span class="s1">&#39;CXX=&quot;c++&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;CXX=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">cxx</span><span class="p">,</span>
            <span class="n">join_path</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="s1">&#39;mpicxx&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
</dd>
<dt><code class="xref py py-func docutils literal"><span class="pre">change_sed_delimiter(old_delim,</span> <span class="pre">new_delim,</span> <span class="pre">*filenames)</span></code></dt>
<dd><p class="first">Some packages, like TAU, have a build system that can&#8217;t install
into directories with, e.g. &#8216;&#64;&#8217; in the name, because they use
hard-coded <code class="docutils literal"><span class="pre">sed</span></code> commands in their build.</p>
<p><code class="docutils literal"><span class="pre">change_sed_delimiter</span></code> finds all <code class="docutils literal"><span class="pre">sed</span></code> search/replace commands
and change the delimiter.  e.g., if the file contains commands
that look like <code class="docutils literal"><span class="pre">s///</span></code>, you can use this to change them to
<code class="docutils literal"><span class="pre">s&#64;&#64;&#64;</span></code>.</p>
<p>Example of changing <code class="docutils literal"><span class="pre">s///</span></code> to <code class="docutils literal"><span class="pre">s&#64;&#64;&#64;</span></code> in TAU:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">change_sed_delimiter</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;configure&#39;</span><span class="p">)</span>
<span class="n">change_sed_delimiter</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;utils/FixMakefile&#39;</span><span class="p">)</span>
<span class="n">change_sed_delimiter</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;utils/FixMakefile.sed.default&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="file-functions">
<h3>File functions<a class="headerlink" href="#file-functions" title="Permalink to this headline"></a></h3>
<dl class="docutils">
<dt><a class="reference internal" href="spack.html#spack.ancestor" title="spack.ancestor"><code class="xref py py-func docutils literal"><span class="pre">ancestor(dir,</span> <span class="pre">n=1)</span></code></a></dt>
<dd>Get the n<sup>th</sup> ancestor of the directory <code class="docutils literal"><span class="pre">dir</span></code>.</dd>
<dt><a class="reference internal" href="spack.html#spack.can_access" title="spack.can_access"><code class="xref py py-func docutils literal"><span class="pre">can_access(path)</span></code></a></dt>
<dd>True if we can read and write to the file at <code class="docutils literal"><span class="pre">path</span></code>.  Same as
native python <code class="docutils literal"><span class="pre">os.access(file_name,</span> <span class="pre">os.R_OK|os.W_OK)</span></code>.</dd>
<dt><a class="reference internal" href="spack.html#spack.install" title="spack.install"><code class="xref py py-func docutils literal"><span class="pre">install(src,</span> <span class="pre">dest)</span></code></a></dt>
<dd><p class="first">Install a file to a particular location.  For example, install a
header into the <code class="docutils literal"><span class="pre">include</span></code> directory under the install <code class="docutils literal"><span class="pre">prefix</span></code>:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">install</span><span class="p">(</span><span class="s1">&#39;my-header.h&#39;</span><span class="p">,</span> <span class="n">join_path</span><span class="p">(</span><span class="n">prefix</span><span class="o">.</span><span class="n">include</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="spack.html#spack.join_path" title="spack.join_path"><code class="xref py py-func docutils literal"><span class="pre">join_path(prefix,</span> <span class="pre">*args)</span></code></a> Like</dt>
<dd><code class="docutils literal"><span class="pre">os.path.join</span></code>, this joins paths using the OS path separator.
However, this version allows an arbitrary number of arguments, so
you can string together many path components.</dd>
<dt><a class="reference internal" href="spack.html#spack.mkdirp" title="spack.mkdirp"><code class="xref py py-func docutils literal"><span class="pre">mkdirp(*paths)</span></code></a></dt>
<dd>Create each of the directories in <code class="docutils literal"><span class="pre">paths</span></code>, creating any parent
directories if they do not exist.</dd>
<dt><a class="reference internal" href="spack.html#spack.working_dir" title="spack.working_dir"><code class="xref py py-func docutils literal"><span class="pre">working_dir(dirname,</span> <span class="pre">kwargs)</span></code></a></dt>
<dd><p class="first">This is a Python <a class="reference external" href="https://docs.python.org/2/library/contextlib.html">Context Manager</a> that makes it
easier to work with subdirectories in builds.  You use this with the
Python <code class="docutils literal"><span class="pre">with</span></code> statement to change into a working directory, and
when the with block is done, you change back to the original
directory.  Think of it as a safe <code class="docutils literal"><span class="pre">pushd</span></code> / <code class="docutils literal"><span class="pre">popd</span></code> combination,
where <code class="docutils literal"><span class="pre">popd</span></code> is guaranteed to be called at the end, even if
exceptions are thrown.</p>
<p>Example usage:</p>
<ol class="last arabic">
<li><p class="first">The <code class="docutils literal"><span class="pre">libdwarf</span></code> build first runs <code class="docutils literal"><span class="pre">configure</span></code> and <code class="docutils literal"><span class="pre">make</span></code> in a
subdirectory called <code class="docutils literal"><span class="pre">libdwarf</span></code>.  It then implements the
installation code itself.  This is natural with <code class="docutils literal"><span class="pre">working_dir</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">working_dir</span><span class="p">(</span><span class="s1">&#39;libdwarf&#39;</span><span class="p">):</span>
    <span class="n">configure</span><span class="p">(</span><span class="s2">&quot;--prefix=&quot;</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;--enable-shared&quot;</span><span class="p">)</span>
    <span class="n">make</span><span class="p">()</span>
    <span class="n">install</span><span class="p">(</span><span class="s1">&#39;libdwarf.a&#39;</span><span class="p">,</span>  <span class="n">prefix</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Many CMake builds require that you build &#8220;out of source&#8221;, that
is, in a subdirectory.  You can handle creating and <code class="docutils literal"><span class="pre">cd</span></code>&#8216;ing to
the subdirectory like the LLVM package does:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">working_dir</span><span class="p">(</span><span class="s1">&#39;spack-build&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">cmake</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span>
          <span class="s1">&#39;-DLLVM_REQUIRES_RTTI=1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;-DPYTHON_EXECUTABLE=/usr/bin/python&#39;</span><span class="p">,</span>
          <span class="s1">&#39;-DPYTHON_INCLUDE_DIR=/usr/include/python2.6&#39;</span><span class="p">,</span>
          <span class="s1">&#39;-DPYTHON_LIBRARY=/usr/lib64/libpython2.6.so&#39;</span><span class="p">,</span>
          <span class="o">*</span><span class="n">std_cmake_args</span><span class="p">)</span>
    <span class="n">make</span><span class="p">()</span>
    <span class="n">make</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">create=True</span></code> keyword argument causes the command to create
the directory if it does not exist.</p>
</li>
</ol>
</dd>
<dt><a class="reference internal" href="spack.html#spack.touch" title="spack.touch"><code class="xref py py-func docutils literal"><span class="pre">touch(path)</span></code></a></dt>
<dd>Create an empty file at <code class="docutils literal"><span class="pre">path</span></code>.</dd>
</dl>
</div>
</div>
<div class="section" id="packaging-workflow-commands">
<span id="package-lifecycle"></span><h2>Packaging workflow commands<a class="headerlink" href="#packaging-workflow-commands" title="Permalink to this headline"></a></h2>
<p>When you are building packages, you will likely not get things
completely right the first time.</p>
<p>The <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> command performs a number of tasks before it
finally installs each package.  It downloads an archive, expands it in
a temporary directory, and only then gives control to the package&#8217;s
<code class="docutils literal"><span class="pre">install()</span></code> method.  If the build doesn&#8217;t go as planned, you may
want to clean up the temporary directory, or if the package isn&#8217;t
downloading properly, you might want to run <em>only</em> the <code class="docutils literal"><span class="pre">fetch</span></code> stage
of the build.</p>
<p>A typical package workflow might look like this:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack edit mypackage
$ spack install mypackage
... build breaks! ...
$ spack clean mypackage
$ spack edit mypackage
$ spack install mypackage
... repeat clean/install <span class="k">until</span> install works ...
</pre></div>
</div>
<p>Below are some commands that will allow you some finer-grained
control over the install process.</p>
<div class="section" id="spack-fetch">
<span id="id14"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">fetch</span></code><a class="headerlink" href="#spack-fetch" title="Permalink to this headline"></a></h3>
<p>The first step of <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code>.  Takes a spec and determines the
correct download URL to use for the requested package version, then
downloads the archive, checks it against an MD5 checksum, and stores
it in a staging directory if the check was successful.  The staging
directory will be located under <code class="docutils literal"><span class="pre">$SPACK_HOME/var/spack</span></code>.</p>
<p>When run after the archive has already been downloaded, <code class="docutils literal"><span class="pre">spack</span>
<span class="pre">fetch</span></code> is idempotent and will not download the archive again.</p>
</div>
<div class="section" id="spack-stage">
<span id="id15"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">stage</span></code><a class="headerlink" href="#spack-stage" title="Permalink to this headline"></a></h3>
<p>The second step in <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> after <code class="docutils literal"><span class="pre">spack</span> <span class="pre">fetch</span></code>.  Expands
the downloaded archive in its temporary directory, where it will be
built by <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code>.  Similar to <code class="docutils literal"><span class="pre">fetch</span></code>, if the archive has
already been expanded,  <code class="docutils literal"><span class="pre">stage</span></code> is idempotent.</p>
</div>
<div class="section" id="spack-patch">
<span id="id16"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">patch</span></code><a class="headerlink" href="#spack-patch" title="Permalink to this headline"></a></h3>
<p>After staging, Spack applies patches to downloaded packages, if any
have been specified in the package file.  This command will run the
install process through the fetch, stage, and patch phases.  Spack
keeps track of whether patches have already been applied and skips
this step if they have been.  If Spack discovers that patches didn&#8217;t
apply cleanly on some previous run, then it will restage the entire
package before patching.</p>
</div>
<div class="section" id="spack-restage">
<span id="id17"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">restage</span></code><a class="headerlink" href="#spack-restage" title="Permalink to this headline"></a></h3>
<p>Restores the source code to pristine state, as it was before building.</p>
<p>Does this in one of two ways:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If the source was fetched as a tarball, deletes the entire build
directory and re-expands the tarball.</li>
<li>If the source was checked out from a repository, this deletes the
build directory and checks it out again.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="spack-clean">
<span id="id18"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">clean</span></code><a class="headerlink" href="#spack-clean" title="Permalink to this headline"></a></h3>
<p>Cleans up temporary files for a particular package, by deleting the
expanded/checked out source code <em>and</em> any downloaded archive.  If
<code class="docutils literal"><span class="pre">fetch</span></code>, <code class="docutils literal"><span class="pre">stage</span></code>, or <code class="docutils literal"><span class="pre">install</span></code> are run again after this, Spack&#8217;s
build process will start from scratch.</p>
</div>
<div class="section" id="spack-purge">
<span id="id19"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">purge</span></code><a class="headerlink" href="#spack-purge" title="Permalink to this headline"></a></h3>
<p>Cleans up all of Spack&#8217;s temporary files.  Use this to recover disk
space if temporary files from interrupted or failed installs
accumulate in the staging area.  This is equivalent to running <code class="docutils literal"><span class="pre">spack</span>
<span class="pre">clean</span></code> for every package you have fetched or staged.</p>
</div>
<div class="section" id="keeping-the-stage-directory-on-success">
<h3>Keeping the stage directory on success<a class="headerlink" href="#keeping-the-stage-directory-on-success" title="Permalink to this headline"></a></h3>
<p>By default, <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> will delete the staging area once a
package has been successfully built and installed.  Use
<code class="docutils literal"><span class="pre">--keep-stage</span></code> to leave the build directory intact:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack install --keep-stage &lt;spec&gt;
</pre></div>
</div>
<p>This allows you to inspect the build directory and potentially debug
the build.  You can use <code class="docutils literal"><span class="pre">purge</span></code> or <code class="docutils literal"><span class="pre">clean</span></code> later to get rid of the
unwanted temporary files.</p>
</div>
<div class="section" id="keeping-the-install-prefix-on-failure">
<h3>Keeping the install prefix on failure<a class="headerlink" href="#keeping-the-install-prefix-on-failure" title="Permalink to this headline"></a></h3>
<p>By default, <code class="docutils literal"><span class="pre">spack</span> <span class="pre">install</span></code> will delete any partially constructed
install prefix if anything fails during <code class="docutils literal"><span class="pre">install()</span></code>.  If you want to
keep the prefix anyway (e.g. to diagnose a bug), you can use
<code class="docutils literal"><span class="pre">--keep-prefix</span></code>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack install --keep-prefix &lt;spec&gt;
</pre></div>
</div>
<p>Note that this may confuse Spack into thinking that the package has
been installed properly, so you may need to use <code class="docutils literal"><span class="pre">spack</span> <span class="pre">uninstall</span> <span class="pre">-f</span></code>
to get rid of the install prefix before you build again:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>spack uninstall -f &lt;spec&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="graphing-dependencies">
<h2>Graphing dependencies<a class="headerlink" href="#graphing-dependencies" title="Permalink to this headline"></a></h2>
<div class="section" id="spack-graph">
<span id="id20"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">graph</span></code><a class="headerlink" href="#spack-graph" title="Permalink to this headline"></a></h3>
<p>Spack provides the <code class="docutils literal"><span class="pre">spack</span> <span class="pre">graph</span></code> command for graphing dependencies.
The command by default generates an ASCII rendering of a spec&#8217;s
dependency graph.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ spack graph mpileaks
o  mpileaks
|\
| |\
| o |  callpath
|/| |
| |\|
| |\ \
| | |\ \
| | | | o  adept-utils
| |_|_|/|
|/| | | |
o | | | |  mpi
 / / / /
| | o |  dyninst
| |/| |
|/|/| |
| | |/
| o |  libdwarf
|/ /
o |  libelf
 /
o  boost
</pre></div>
</div>
<p>At the top is the root package in the DAG, with dependency edges
emerging from it.  On a color terminal, the edges are colored by which
dependency they lead to.</p>
<p>You can also use <code class="docutils literal"><span class="pre">spack</span> <span class="pre">graph</span></code> to generate graphs in the widely used
<a class="reference external" href="http://www.graphviz.org/doc/info/lang.html">Dot</a> format.  For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ spack graph --dot mpileaks
digraph G {
  label = &quot;Spack Dependencies&quot;
  labelloc = &quot;b&quot;
  rankdir = &quot;LR&quot;
  ranksep = &quot;5&quot;

  &quot;boost&quot;                        [label=&quot;boost&quot;]
  &quot;callpath&quot;                     [label=&quot;callpath&quot;]
  &quot;libdwarf&quot;                     [label=&quot;libdwarf&quot;]
  &quot;mpileaks&quot;                     [label=&quot;mpileaks&quot;]
  &quot;mpi&quot;                          [label=&quot;mpi&quot;]
  &quot;adept-utils&quot;                  [label=&quot;adept-utils&quot;]
  &quot;dyninst&quot;                      [label=&quot;dyninst&quot;]
  &quot;libelf&quot;                       [label=&quot;libelf&quot;]

  &quot;callpath&quot; -&gt; &quot;dyninst&quot;
  &quot;callpath&quot; -&gt; &quot;adept-utils&quot;
  &quot;callpath&quot; -&gt; &quot;mpi&quot;
  &quot;callpath&quot; -&gt; &quot;libelf&quot;
  &quot;callpath&quot; -&gt; &quot;libdwarf&quot;
  &quot;libdwarf&quot; -&gt; &quot;libelf&quot;
  &quot;mpileaks&quot; -&gt; &quot;adept-utils&quot;
  &quot;mpileaks&quot; -&gt; &quot;callpath&quot;
  &quot;mpileaks&quot; -&gt; &quot;mpi&quot;
  &quot;adept-utils&quot; -&gt; &quot;boost&quot;
  &quot;adept-utils&quot; -&gt; &quot;mpi&quot;
  &quot;dyninst&quot; -&gt; &quot;boost&quot;
  &quot;dyninst&quot; -&gt; &quot;libelf&quot;
  &quot;dyninst&quot; -&gt; &quot;libdwarf&quot;
}
</pre></div>
</div>
<p>This graph can be provided as input to other graphing tools, such as
those in <a class="reference external" href="http://www.graphviz.org">Graphviz</a>.</p>
</div>
</div>
<div class="section" id="interactive-shell-support">
<h2>Interactive shell support<a class="headerlink" href="#interactive-shell-support" title="Permalink to this headline"></a></h2>
<p>Spack provides some limited shell support to make life easier for
packagers.  You can enable these commands by sourcing a setup file in
the <code class="docutils literal"><span class="pre">/share/spack</span></code> directory.  For <code class="docutils literal"><span class="pre">bash</span></code> or <code class="docutils literal"><span class="pre">ksh</span></code>, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>. $SPACK_ROOT/share/spack/setup-env.sh
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">csh</span></code> and <code class="docutils literal"><span class="pre">tcsh</span></code> run:</p>
<blockquote>
<div>setenv SPACK_ROOT /path/to/spack
source $SPACK_ROOT/share/spack/setup-env.csh</div></blockquote>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code> will then be available.</p>
<div class="section" id="spack-cd">
<span id="id21"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code><a class="headerlink" href="#spack-cd" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code> allows you to quickly cd to pertinent directories in Spack.
Suppose you&#8217;ve staged a package but you want to modify it before you
build it:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack stage <span class="nv">libelf</span>
<span class="o">==</span>&gt; Trying to fetch from http://www.mr511.de/software/libelf-0.8.13.tar.gz
<span class="c1">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; Staging archive: /Users/gamblin2/src/spack/var/spack/stage/libelf@0.8.13%gcc@4.8.3<span class="o">=</span>linux-ppc64/libelf-0.8.13.tar.gz
<span class="o">==</span>&gt; Created stage in /Users/gamblin2/src/spack/var/spack/stage/libelf@0.8.13%gcc@4.8.3<span class="o">=</span>linux-ppc64.
$ spack <span class="nb">cd</span> libelf
$ <span class="nb">pwd</span>
/Users/gamblin2/src/spack/var/spack/stage/libelf@0.8.13%gcc@4.8.3<span class="o">=</span>linux-ppc64/libelf-0.8.13
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code> here changed he current working directory to the
directory containing the expanded <code class="docutils literal"><span class="pre">libelf</span></code> source code.  There are a
number of other places you can cd to in the spack directory hierarchy:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ spack cd -h
usage: spack cd [-h] [-m | -r | -i | -p | -P | -s | -S | -b] ...

positional arguments:
  spec               spec of package to fetch directory for.

optional arguments:
  -h, --help         show this help message and exit
  -m, --module-dir   Spack python module directory.
  -r, --spack-root   Spack installation root.
  -i, --install-dir  Install prefix for spec (spec need not be installed).
  -p, --package-dir  Directory enclosing a spec&#39;s package.py file.
  -P, --packages     Top-level packages directory for Spack.
  -s, --stage-dir    Stage directory for a spec.
  -S, --stages       Top level Stage directory.
  -b, --build-dir    Checked out or expanded source directory for a spec
                     (requires it to be staged first).
</pre></div>
</div>
<p>Some of these change directory into package-specific locations (stage
directory, install directory, package directory) and others change to
core spack locations.  For example, <code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span> <span class="pre">-m</span></code> will take you to
the main python source directory of your spack install.</p>
</div>
<div class="section" id="spack-env">
<span id="id22"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">env</span></code><a class="headerlink" href="#spack-env" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">env</span></code> functions much like the standard unix <code class="docutils literal"><span class="pre">env</span></code> command,
but it takes a spec as an argument.  You can use it to see the
environment variables that will be set when a particular build runs,
for example:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack env mpileaks@1.1%intel
</pre></div>
</div>
<p>This will display the entire environment that will be set when the
<code class="docutils literal"><span class="pre">mpileaks&#64;1.1%intel</span></code> build runs.</p>
<p>To run commands in a package&#8217;s build environment, you can simply provided them after the spec argument to <code class="docutils literal"><span class="pre">spack</span> <span class="pre">env</span></code>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ spack <span class="nb">cd</span> mpileaks@1.1%intel
$ spack env mpileaks@1.1%intel ./configure
</pre></div>
</div>
<p>This will cd to the build directory and then run <code class="docutils literal"><span class="pre">configure</span></code> in the
package&#8217;s build environment.</p>
</div>
<div class="section" id="spack-location">
<span id="id23"></span><h3><code class="docutils literal"><span class="pre">spack</span> <span class="pre">location</span></code><a class="headerlink" href="#spack-location" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">location</span></code> is the same as <code class="docutils literal"><span class="pre">spack</span> <span class="pre">cd</span></code> but it does not require
shell support.  It simply prints out the path you ask for, rather than
cd&#8217;ing to it.  In bash, this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $(spack location -b &lt;spec&gt;)
</pre></div>
</div>
<p>is the same as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>spack cd -b &lt;spec&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">spack</span> <span class="pre">location</span></code> is intended for use in scripts or makefiles that
need to know where packages are installed.  e.g., in a makefile you
might write:</p>
<div class="highlight-makefile"><div class="highlight"><pre><span></span><span class="nv">DWARF_PREFIX</span> <span class="o">=</span> <span class="k">$(</span>spack location -i libdwarf<span class="k">)</span>
<span class="nv">CXXFLAGS</span> <span class="o">+=</span> -I<span class="nv">$DWARF_PREFIX</span>/include
<span class="nv">CXXFLAGS</span> <span class="o">+=</span> -L<span class="nv">$DWARF_PREFIX</span>/lib
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mirrors.html" class="btn btn-neutral float-right" title="Mirrors" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basic_usage.html" class="btn btn-neutral" title="Basic usage" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2015, Lawrence Livermore National Laboratory..

    <br/>
    Written by Todd Gamblin (<a href="mailto:tgamblin@llnl.gov">tgamblin@llnl.gov</a>) and
    many contributors. LLNL-CODE-647188.
      <br/>
      Last updated on May 10, 2016.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>